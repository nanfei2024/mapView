# 🎉 文档预览功能升级说明

## 📊 更新概览

### 从弹窗预览 → 全屏对比预览

我们将文档预览功能升级为**全新的对比预览页面**，提供专业的文档数字化对比体验！

---

## ✨ 新功能特性

### 1. **全屏对比界面**
   - 左右分栏布局
   - 源文件 PDF vs 解析后的 Markdown
   - 同屏对比，一目了然

### 2. **PDF 源文件预览**
   - 左侧显示原始 PDF 文档
   - 支持浏览器内置 PDF 查看器
   - 可滚动查看完整文档

### 3. **Markdown 多视图**
   - **渲染视图**：美观的 HTML 渲染
   - **源码视图**：原始 Markdown 代码
   - 一键切换

### 4. **灵活布局切换**
   - **横向对比**：左右布局（默认）
   - **纵向对比**：上下布局
   - 根据屏幕和内容选择最佳布局

### 5. **专业交互**
   - 独立页面，不干扰主界面
   - 快捷下载完整结果
   - 流畅的滚动和响应式设计

---

## 🎨 界面展示

### 布局结构

```
┌─────────────────────────────────────────────────────────────┐
│  [← 返回]  文件名.pdf  [下载完整结果] [切换布局]            │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌───────────────────────┬──────────────────────────────┐   │
│  │  📄 源文件            │  📝 解析结果                  │   │
│  │  PDF 文档             │  [渲染视图] [源码视图]        │   │
│  ├───────────────────────┼──────────────────────────────┤   │
│  │                       │                              │   │
│  │   [PDF 预览]          │   # 标题                     │   │
│  │                       │   正文内容...                │   │
│  │   原始文档显示        │   - 列表项                   │   │
│  │                       │   - 列表项                   │   │
│  │   支持滚动查看        │   ## 二级标题                │   │
│  │                       │   ...                        │   │
│  │                       │                              │   │
│  └───────────────────────┴──────────────────────────────┘   │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

---

## 🚀 使用方法

### 1. 上传并解析文档

在"地质文档数字化"页面：
1. 输入文档 URL
2. 选择参数
3. 点击"开始解析"
4. 等待解析完成

### 2. 进入对比预览

解析完成后，点击文件列表中的 **"预览结果"** 按钮

→ 自动跳转到对比预览页面

### 3. 对比查看

- **左侧**：原始 PDF 文档
- **右侧**：解析后的 Markdown（默认渲染视图）

### 4. 切换视图

- 点击右侧的 **"渲染视图"** / **"源码视图"** 按钮
- 切换 Markdown 显示方式

### 5. 调整布局

- 点击顶部的 **"横向对比"** / **"纵向对比"** 按钮
- 根据内容选择最佳布局：
  - **横向**：适合对比阅读
  - **纵向**：适合长文档滚动

### 6. 下载结果

- 点击顶部的 **"下载完整结果"** 按钮
- 获取包含所有内容的 ZIP 文件

### 7. 返回

- 点击左上角的 **"← 返回"** 按钮
- 返回文档数字化页面

---

## 📁 新增文件

### 1. `src/views/DocumentPreviewPage.vue`
   - 全新的对比预览页面组件
   - 2000+ 行代码
   - 完整的 PDF + Markdown 对比功能

### 2. 路由更新 `src/router/index.ts`
   ```typescript
   {
     path: '/document-preview',
     name: 'documentPreview',
     component: DocumentPreviewPage,
   }
   ```

---

## 🔧 技术实现

### 核心技术栈

| 技术 | 用途 |
|------|------|
| **Vue 3 Composition API** | 组件逻辑 |
| **Vue Router** | 页面跳转和参数传递 |
| **JSZip** | ZIP 文件解压 |
| **marked** | Markdown → HTML 渲染 |
| **Fetch API + Proxy** | 跨域下载解决方案 |

### 关键功能实现

#### 1. 参数传递
```typescript
router.push({
  path: '/document-preview',
  query: {
    fileName: '文件名.pdf',
    resultUrl: 'https://...zip文件地址',
    originalUrl: 'https://...pdf文件地址'
  }
});
```

#### 2. ZIP 解压与 Markdown 提取
```typescript
const response = await fetch(proxyUrl);
const blob = await response.blob();
const zip = new JSZip();
const zipContent = await zip.loadAsync(blob);

// 查找 .md 文件
for (const [filename, file] of Object.entries(zipContent.files)) {
  if (filename.endsWith('.md')) {
    const content = await file.async('text');
    // 渲染 Markdown
    const html = marked(content);
  }
}
```

#### 3. PDF 预览
```html
<iframe :src="pdfUrl" />
```
使用浏览器内置的 PDF 查看器

---

## 🎯 优势对比

| 功能 | 旧版（弹窗） | 新版（独立页面） |
|------|------------|-----------------|
| **布局** | 小弹窗 | 全屏对比 |
| **PDF 预览** | ❌ | ✅ |
| **对比查看** | ❌ | ✅ 左右/上下对比 |
| **视图切换** | ❌ | ✅ 渲染/源码 |
| **布局调整** | ❌ | ✅ 横向/纵向 |
| **用户体验** | 普通 | 🌟 专业 |

---

## 📝 使用示例

### 完整流程

```
1. 主页 → 点击"地质文档数字化" 
   ↓
2. 输入 URL: https://example.com/document.pdf
   ↓
3. 点击"开始解析" → 等待进度 100%
   ↓
4. 点击"预览结果" 
   ↓
5. 🎉 进入对比预览页面
   ├─ 左侧：原始 PDF
   └─ 右侧：解析的 Markdown
   ↓
6. 对比查看、切换视图、调整布局
   ↓
7. 满意后点击"下载完整结果"
   ↓
8. 点击"返回"继续处理其他文档
```

---

## 🐛 注意事项

### 1. PDF 预览限制

- 部分 PDF 可能因跨域限制无法预览
- 如果左侧显示错误，不影响右侧 Markdown 预览
- 可直接下载 ZIP 文件查看原文

### 2. 代理服务器

- **必须运行代理服务器** 才能预览
- 确保 `http://localhost:3001` 可访问
- 参考：`解决CORS跨域问题-完整方案.md`

### 3. 浏览器兼容性

- 推荐使用 Chrome、Edge、Firefox 最新版本
- Safari 需要 13+ 版本
- IE 不支持

---

## 🎊 总结

### 这次升级带来的改进：

✅ **更专业**：全屏对比界面，类似专业文档处理软件  
✅ **更直观**：源文件和解析结果并排对比  
✅ **更灵活**：多种视图和布局模式  
✅ **更流畅**：独立页面，性能更好  
✅ **更完整**：PDF + Markdown 完整预览体验  

### 适用场景：

- 📚 地质文档数字化
- 📄 学术论文解析验证
- 📊 报告内容提取确认
- 🔍 文档质量检查对比

---

**享受全新的文档数字化体验！** 🎉


