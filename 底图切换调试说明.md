# 底图切换调试说明 🔍

## 🐛 问题描述

用户反馈：点击"底图切换"按钮没有反应，没有显示五个底图选项。

## 🔧 诊断步骤

### 1. 检查点击事件
添加了 console.log 调试输出：
```javascript
const toggleBasemapPanel = () => {
  console.log('点击了底图切换按钮');
  console.log('切换前 showBasemapPanel:', showBasemapPanel.value);
  console.log('sidebarCollapsed:', sidebarCollapsed.value);
  showBasemapPanel.value = !showBasemapPanel.value;
  console.log('切换后 showBasemapPanel:', showBasemapPanel.value);
  console.log('basemaps:', basemaps);
  // ...
};
```

### 2. 检查显示条件

**原来的条件：**
```html
<div class="sub-menu basemap-sub-menu" v-show="showBasemapPanel && !sidebarCollapsed">
```

**问题分析：**
- 条件 `!sidebarCollapsed` 可能导致子菜单不显示
- 即使侧边栏没有折叠，这个条件也可能有问题

### 3. 简化显示条件

**修改后：**
```html
<div class="sub-menu basemap-sub-menu" v-show="showBasemapPanel">
```

**修改内容：**
- ✅ 移除了 `!sidebarCollapsed` 条件
- ✅ 只保留 `showBasemapPanel` 状态控制
- ✅ 同时也更新了测量工具子菜单（保持一致性）

## 📊 修改对比

### 底图切换子菜单
| 方面 | 修改前 | 修改后 |
|------|--------|--------|
| **显示条件** | `showBasemapPanel && !sidebarCollapsed` | `showBasemapPanel` |
| **逻辑** | ❌ 复杂（两个条件） | ✅ 简单（一个条件） |
| **折叠模式** | ❌ 不显示子菜单 | ✅ 可以显示子菜单 |

### 测量工具子菜单
| 方面 | 修改前 | 修改后 |
|------|--------|--------|
| **显示条件** | `showMeasurePanel && !sidebarCollapsed` | `showMeasurePanel` |
| **逻辑** | ❌ 复杂（两个条件） | ✅ 简单（一个条件） |
| **折叠模式** | ❌ 不显示子菜单 | ✅ 可以显示子菜单 |

## 🎯 测试步骤

### 1. 打开浏览器控制台
- 按 F12 打开开发者工具
- 切换到 Console 标签

### 2. 点击底图切换按钮
检查控制台输出：
```
点击了底图切换按钮
切换前 showBasemapPanel: false
sidebarCollapsed: false
切换后 showBasemapPanel: true
basemaps: (5) [{…}, {…}, {…}, {…}, {…}]
```

### 3. 检查子菜单显示
- ✅ 子菜单应该出现在按钮右侧
- ✅ 显示5个底图选项
- ✅ 当前选中的底图有绿色高亮和 ✓ 图标

### 4. 点击底图选项
- ✅ 地图应该切换到对应底图
- ✅ 子菜单自动关闭

## 🎨 CSS 定位说明

子菜单使用绝对定位：
```css
.sub-menu {
  position: absolute;
  left: 100%;  /* 在父元素右侧 */
  top: 0;      /* 与父元素顶部对齐 */
  margin-left: 8px;  /* 与父元素保持8px间距 */
  z-index: 1001;     /* 确保在最上层 */
}
```

## 🐛 可能的其他问题

### 问题 1：子菜单被遮挡
**症状：** 控制台显示状态改变了，但看不到子菜单

**解决方法：**
检查 z-index，确保子菜单在最上层：
```css
.sub-menu {
  z-index: 1001 !important;
}
```

### 问题 2：点击事件没有触发
**症状：** 控制台没有输出任何日志

**解决方法：**
检查是否有其他元素覆盖在按钮上方：
```css
.nav-item {
  position: relative;  /* 确保子菜单正确定位 */
  z-index: auto;
}
```

### 问题 3：basemaps 数据为空
**症状：** 控制台显示 `basemaps: []`

**解决方法：**
检查 basemaps 数组是否正确定义：
```javascript
const basemaps = [
  { id: 'streets', name: '街道地图', style: 'mapbox://styles/mapbox/streets-v12' },
  { id: 'satellite', name: '卫星影像', style: 'mapbox://styles/mapbox/satellite-v9' },
  { id: 'light', name: '浅色底图', style: 'mapbox://styles/mapbox/light-v11' },
  { id: 'dark', name: '深色底图', style: 'mapbox://styles/mapbox/dark-v11' },
  { id: 'outdoors', name: '地形图', style: 'mapbox://styles/mapbox/outdoors-v12' }
];
```

## 📝 调试清单

请按以下顺序检查：

- [ ] 1. 刷新浏览器页面
- [ ] 2. 打开浏览器控制台（F12）
- [ ] 3. 点击"底图切换"按钮
- [ ] 4. 查看控制台输出：
  - [ ] 是否有 "点击了底图切换按钮" 日志？
  - [ ] `showBasemapPanel` 是否从 false 变为 true？
  - [ ] `basemaps` 数组是否有5个元素？
- [ ] 5. 查看页面：
  - [ ] 是否出现子菜单？
  - [ ] 子菜单位置是否正确？
  - [ ] 是否能看到5个底图选项？
- [ ] 6. 点击任一底图选项：
  - [ ] 地图是否切换？
  - [ ] 子菜单是否关闭？

## 🔄 回滚方案

如果修改后仍有问题，可以尝试以下方案：

### 方案 A：恢复折叠条件
```html
<div class="sub-menu basemap-sub-menu" 
     v-show="showBasemapPanel && !sidebarCollapsed">
```

### 方案 B：使用 v-if 替代 v-show
```html
<div class="sub-menu basemap-sub-menu" 
     v-if="showBasemapPanel">
```

### 方案 C：添加内联样式强制显示
```html
<div class="sub-menu basemap-sub-menu" 
     v-show="showBasemapPanel"
     :style="{ display: showBasemapPanel ? 'block' : 'none' }">
```

## 📞 下一步

1. **如果控制台有输出但子菜单不显示：**
   - 问题在CSS或DOM渲染
   - 检查z-index和定位
   - 检查是否被其他元素遮挡

2. **如果控制台没有输出：**
   - 问题在事件绑定
   - 检查HTML结构是否正确
   - 检查是否有JS错误阻止代码执行

3. **如果子菜单显示但内容为空：**
   - 问题在数据绑定
   - 检查basemaps数组
   - 检查v-for循环

## 🎉 预期结果

修改完成后，应该能够：
- ✅ 点击"底图切换"按钮
- ✅ 看到5个底图选项的子菜单
- ✅ 选项以列表形式显示
- ✅ 当前底图有绿色高亮
- ✅ 点击选项后地图正常切换
- ✅ 选择后子菜单自动关闭

---

**如果问题仍未解决，请提供控制台输出的完整日志！** 📋

