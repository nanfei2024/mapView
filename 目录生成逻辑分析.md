# ä¹¦ç±ç›®å½•ç”Ÿæˆé€»è¾‘åˆ†æ

## ğŸ“Š æ•´ä½“æµç¨‹å›¾

```
ç”¨æˆ·æ‰“å¼€ä¹¦ç±
    â†“
å‰ç«¯: fetchAllMarkdownFiles()
    â†“
åç«¯: GET /api/files/markdown?bookId={id}
    â†“
æ•°æ®åº“æŸ¥è¯¢æ‰€æœ‰ article ç±»å‹æ–‡ä»¶
    â†“
å‰ç«¯æŒ‰ property åˆ†ç»„æ„å»ºç« èŠ‚
    â†“
ç”¨æˆ·ç‚¹å‡»ç« èŠ‚
    â†“
å‰ç«¯: selectSection() â†’ fetchFileToc()
    â†“
åç«¯: GET /api/files/markdown/{fileId}/toc
    â†“
parseMarkdownToc() è§£ææ–‡ä»¶æ ‡é¢˜
    â†“
å‰ç«¯å±•ç¤ºç›®å½•ç»“æ„
```

## ğŸ” å‰ç«¯ç›®å½•ç”Ÿæˆæµç¨‹

### 1. åˆå§‹ç›®å½•æ„å»º (fetchAllMarkdownFiles)

**ä½ç½®**: `BookViewer.vue` è¡Œ 670-841

**å…³é”®æ­¥éª¤**:

```javascript
// 1. è¯·æ±‚æ‰€æœ‰ Markdown æ–‡ä»¶
const url = `http://localhost:8080/api/files/markdown?bookId=${bookId}`;
const response = await axios.get(url);

// 2. æå–æ–‡ä»¶å
const filesWithNames = data.files.map(file => {
  const pathParts = file.file_path.split(/[\/\\]/);
  const fileName = pathParts[pathParts.length - 1];
  return { ...file, fileName };
});

// 3. æŒ‰ç« èŠ‚å±æ€§åˆ†ç»„
const groupedFiles = filesWithNames.reduce((groups, file) => {
  const property = file.property || 'other';
  // æå–ç« èŠ‚å·ï¼šå¦‚ "4.2" -> "4"
  const chapter = property.includes('.') ? property.split('.')[0] : property;
  
  if (!groups[chapter]) {
    groups[chapter] = [];
  }
  groups[chapter].push(file);
  return groups;
}, {});

// 4. è½¬æ¢ä¸ºç« èŠ‚æ ¼å¼
const markdownChapters = Object.keys(groupedFiles)
  .sort((a, b) => {
    const numA = parseInt(a);
    const numB = parseInt(b);
    if (!isNaN(numA) && !isNaN(numB)) {
      return numA - numB;
    }
    return a.localeCompare(b);
  })
  .map(chapter => {
    const files = groupedFiles[chapter];
    
    // æŒ‰å±æ€§æ’åº
    files.sort((a, b) => compareProperties(a.property, b.property));
    
    return {
      chapter,
      title: `ç¬¬${chapter}ç« `,
      expanded: false,
      sections: files.map(file => ({
        title: `${file.property} ${file.fileName.replace(/\.(md|markdown)$/i, '')}`,
        pageNumber: 1,
        fileId: file.id
      }))
    };
  });
```

**é—®é¢˜ç‚¹**:
1. âš ï¸ **ç« èŠ‚å·æå–é€»è¾‘**: ä½¿ç”¨ `property.split('.')[0]` æå–ç« èŠ‚å·ï¼Œå¦‚æœ property æ ¼å¼ä¸è§„èŒƒä¼šå‡ºé—®é¢˜
2. âš ï¸ **æ–‡ä»¶åé‡å¤**: å¦‚æœæ–‡ä»¶åå·²åŒ…å« propertyï¼Œä¼šå¯¼è‡´æ ‡é¢˜é‡å¤æ˜¾ç¤º property
3. âš ï¸ **é”™è¯¯å¤„ç†ä¸è¶³**: æ²¡æœ‰å……åˆ†å¤„ç† property ä¸ºç©ºæˆ–æ ¼å¼å¼‚å¸¸çš„æƒ…å†µ

### 2. å°èŠ‚ç›®å½•è·å– (selectSection + fetchFileToc)

**ä½ç½®**: `BookViewer.vue` è¡Œ 960-993, 844-877

**æµç¨‹**:

```javascript
// é€‰æ‹©å°èŠ‚æ—¶
const selectSection = async (chapterIndex, sectionIndex) => {
  selectedChapter.value = chapterIndex;
  selectedSection.value = sectionIndex;
  
  const section = selectedBook.value?.chapters[chapterIndex].sections[sectionIndex];
  
  // å¦‚æœæ²¡æœ‰ç›®å½•æ•°æ®ï¼Œè·å–æ–‡ä»¶çš„ç›®å½•ç»“æ„
  if (section && section.fileId && !section.toc) {
    loading.value = true;
    const result = await fetchFileToc(section.fileId);
    loading.value = false;
    
    if (result && result.toc) {
      // è¿‡æ»¤å›¾ç‰‡æ ‡é¢˜
      const filteredToc = result.toc.map(item => {
        const isImage = Boolean(
          item.title.trim().startsWith('å›¾') || 
          (item.numericPrefix && item.numericPrefix.startsWith('å›¾'))
        );
        return { ...item, isImage };
      });
      
      // æ›´æ–°å°èŠ‚çš„ç›®å½•æ•°æ®
      selectedBook.value.chapters[chapterIndex].sections[sectionIndex].toc = filteredToc;
    }
  }
};

// è·å–æ–‡ä»¶ç›®å½•
const fetchFileToc = async (fileId) => {
  const url = `http://localhost:8080/api/files/markdown/${fileId}/toc`;
  const response = await axios.get(url);
  return response.data;
};
```

**é—®é¢˜ç‚¹**:
1. âœ… **æ‡’åŠ è½½**: åªåœ¨ç”¨æˆ·ç‚¹å‡»æ—¶æ‰è·å–ç›®å½•ï¼Œè¿™æ˜¯åˆç†çš„
2. âš ï¸ **å›¾ç‰‡æ ‡é¢˜è¯†åˆ«**: åªæ£€æŸ¥"å›¾"å¼€å¤´ï¼Œå¯èƒ½æ— æ³•è¯†åˆ«æ‰€æœ‰å›¾ç‰‡æ ‡é¢˜æ ¼å¼
3. âš ï¸ **ç¼“å­˜æœºåˆ¶**: æ²¡æœ‰æ¸…ç†æœºåˆ¶ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜å ç”¨å¢é•¿

### 3. å›¾ç›®å½•ç”Ÿæˆ (figureCatalog)

**ä½ç½®**: `BookViewer.vue` è¡Œ 2659-2677

**æµç¨‹**:

```javascript
const figureCatalog = computed(() => {
  // ä½¿ç”¨åç«¯è¿”å›çš„å›¾ç‰‡åˆ—è¡¨
  if (!sectionImages.value || sectionImages.value.length === 0) return [];
  
  // è¿‡æ»¤å‡ºå›¾ç‰‡æ–‡ä»¶
  return sectionImages.value
    .filter(img => {
      const name = img.name || '';
      const url = img.url || '';
      return /\.(jpg|jpeg|png|gif|bmp|webp|svg)$/i.test(name || url);
    })
    .map(img => ({
      id: img.name,
      title: img.name,
      url: img.url
    }));
});
```

**é—®é¢˜ç‚¹**:
1. âš ï¸ **å‘½åä¸ä¸€è‡´**: å›¾ç›®å½•ä¾èµ–äº `sectionImages`ï¼Œè€Œ `sectionImages` çš„è·å–é€»è¾‘åœ¨ watch ä¸­
2. âš ï¸ **property æå–**: ä»ç« èŠ‚æ ‡é¢˜æå– property å¯èƒ½ä¸å‡†ç¡®

## ğŸ” åç«¯ç›®å½•ç”Ÿæˆé€»è¾‘

### 1. è·å–æ‰€æœ‰ Markdown æ–‡ä»¶

**ä½ç½®**: `FileQueryController.java` è¡Œ 504-532

**æµç¨‹**:

```java
@GetMapping("/markdown")
public ResponseEntity<Map<String, Object>> getAllMarkdownFiles(
        @RequestParam(value = "bookId", required = false) Integer bookId) {
    // ä½¿ç”¨ä¼ å…¥çš„ bookId æˆ–é»˜è®¤ä¸º 1
    Integer targetBookId = bookId != null ? bookId : 1;
    
    // æŸ¥è¯¢æ‰€æœ‰ article ç±»å‹çš„æ–‡ä»¶
    List<Map<String, Object>> allArticleFiles = 
        fileMapper.findFilesByBookAndType(targetBookId, "article");
    
    // è¿‡æ»¤å‡º .md æ–‡ä»¶
    List<Map<String, Object>> mdFiles = allArticleFiles.stream()
        .filter(file -> {
            String filePath = (String) file.get("file_path");
            return isMarkdownFile(filePath);
        })
        .collect(Collectors.toList());
    
    Map<String, Object> response = new HashMap<>();
    response.put("files", mdFiles);
    response.put("total", mdFiles.size());
    
    return ResponseEntity.ok(response);
}
```

**é—®é¢˜ç‚¹**:
1. âœ… **æ–‡ä»¶ç±»å‹è¿‡æ»¤**: æ­£ç¡®è¿‡æ»¤äº† .md å’Œ .markdown æ–‡ä»¶
2. âš ï¸ **æ•°æ®åº“ä¾èµ–**: ä¾èµ–æ•°æ®åº“ä¸­çš„ `property` å­—æ®µå¿…é¡»æ­£ç¡®
3. âš ï¸ **æ€§èƒ½**: æ²¡æœ‰åˆ†é¡µï¼Œå¦‚æœæ–‡ä»¶å¾ˆå¤šå¯èƒ½å½±å“æ€§èƒ½

### 2. è§£æå•ä¸ªæ–‡ä»¶çš„ç›®å½• (parseMarkdownToc)

**ä½ç½®**: `FileQueryController.java` è¡Œ 587-629

**æ ¸å¿ƒæ­£åˆ™è¡¨è¾¾å¼**:

```java
// åŒ¹é…æ ‡é¢˜è¡Œ: # åˆ° ###### 
Pattern pattern = Pattern.compile("^(#{1,6})\\s+(.+?)\\s*(?:\\{#(.+?)\\})?$", Pattern.MULTILINE);

// æå–æ•°å­—å‰ç¼€: 4.2.1
Pattern numPattern = Pattern.compile("^(\\d+(?:\\.\\d+)*)\\s+(.+)$");
```

**å¤„ç†æµç¨‹**:

```java
while (matcher.find()) {
    String headerMarks = matcher.group(1);  // ### 
    String title = matcher.group(2).trim();  // æ ‡é¢˜å†…å®¹
    String id = matcher.group(3);  // å¯é€‰çš„ {#id}
    
    int level = headerMarks.length();  // æ ‡é¢˜çº§åˆ«
    
    // æå–æ•°å­—å‰ç¼€
    String numericPrefix = "";
    Matcher numMatcher = numPattern.matcher(title);
    if (numMatcher.find()) {
        numericPrefix = numMatcher.group(1);  // 4.2.1
        title = numMatcher.group(2);  // ç§»é™¤å‰ç¼€åçš„æ ‡é¢˜
    }
    
    Map<String, Object> heading = new HashMap<>();
    heading.put("level", level);
    heading.put("title", title);
    heading.put("numericPrefix", numericPrefix);
    
    if (id != null) {
        heading.put("id", id);
    } else if (!numericPrefix.isEmpty()) {
        heading.put("id", "heading-" + numericPrefix.replace(".", "-"));
    }
    
    toc.add(heading);
}
```

**é—®é¢˜ç‚¹**:
1. âœ… **æ”¯æŒå¤šçº§æ ‡é¢˜**: æ­£ç¡®æ”¯æŒ # åˆ° ###### 
2. âœ… **æå–æ•°å­—å‰ç¼€**: èƒ½å¤Ÿè¯†åˆ« "4.2.1 æ ‡é¢˜" æ ¼å¼
3. âš ï¸ **å›¾ç‰‡æ ‡é¢˜**: æ²¡æœ‰åœ¨åç«¯æ ‡è®°å›¾ç‰‡æ ‡é¢˜ï¼Œä¾èµ–å‰ç«¯åˆ¤æ–­
4. âš ï¸ **ç‰¹æ®Šæ ‡é¢˜**: å¯èƒ½æ— æ³•å¤„ç†åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æ ‡é¢˜

### 3. ç« èŠ‚ç›®å½•ç»“æ„ (getChapterToc)

**ä½ç½®**: `FileQueryController.java` è¡Œ 716-838

**æµç¨‹**:

```java
// 1. æŸ¥è¯¢æ‰€æœ‰ Markdown æ–‡ä»¶
List<Map<String, Object>> mdFiles = /* ... */;

// 2. æŒ‰ç« èŠ‚å±æ€§åˆ†ç»„
Map<String, List<Map<String, Object>>> chapterFiles = mdFiles.stream()
    .collect(Collectors.groupingBy(file -> {
        String property = (String) file.get("property");
        // æå–ä¸»ç« èŠ‚å·ï¼š4.2 -> 4
        if (property != null && property.contains(".")) {
            return property.substring(0, property.indexOf("."));
        }
        return property != null ? property : "other";
    }));

// 3. æ„å»ºç« èŠ‚ç›®å½•ç»“æ„
for (Map.Entry<String, List<Map<String, Object>>> entry : chapterFiles.entrySet()) {
    String chapterKey = entry.getKey();
    List<Map<String, Object>> files = entry.getValue();
    
    // æŒ‰å±æ€§æ’åº
    files.sort((a, b) -> compareProperties(
        (String) a.get("property"), 
        (String) b.get("property")
    ));
    
    // å¤„ç†æ¯ä¸ªæ–‡ä»¶ï¼Œæå–ç›®å½•
    for (Map<String, Object> file : files) {
        // è¯»å–æ–‡ä»¶å†…å®¹
        String content = new String(Files.readAllBytes(mdFile.toPath()));
        
        // è§£ææ ‡é¢˜
        List<Map<String, Object>> toc = parseMarkdownToc(content);
        
        // æ„å»º section å¯¹è±¡
        Map<String, Object> section = new HashMap<>();
        section.put("fileId", fileId);
        section.put("property", property);
        section.put("toc", toc);
        
        sections.add(section);
    }
}
```

## ğŸ› è¯†åˆ«åˆ°çš„ä¸»è¦é—®é¢˜

### 1. Property æ ¼å¼ä¾èµ–æ€§å¼º

**é—®é¢˜**: æ•´ä¸ªç³»ç»Ÿé«˜åº¦ä¾èµ– `property` å­—æ®µçš„æ ¼å¼ (å¦‚ "4.2", "4.3.1")

**å½±å“**:
- å¦‚æœ property ä¸ºç©ºæˆ–æ ¼å¼ä¸è§„èŒƒï¼Œç« èŠ‚åˆ†ç»„ä¼šå¤±è´¥
- property æå–é€»è¾‘åœ¨å‰åç«¯ä¸ä¸€è‡´

**ç¤ºä¾‹**:
```javascript
// å‰ç«¯æå–ç« èŠ‚å·
const chapter = property.includes('.') ? property.split('.')[0] : property;

// åç«¯æå–ç« èŠ‚å·
return property.substring(0, property.indexOf("."));
```

**å»ºè®®**:
1. ç»Ÿä¸€å‰åç«¯çš„ property è§£æé€»è¾‘
2. æ·»åŠ  property æ ¼å¼éªŒè¯
3. å¤„ç†è¾¹ç•Œæƒ…å†µï¼ˆç©ºå€¼ã€æ— ç‚¹å·ã€å¤šç‚¹å·ï¼‰

### 2. æ–‡ä»¶åä¸æ ‡é¢˜é‡å¤

**é—®é¢˜**: åœ¨æ„å»º section æ ‡é¢˜æ—¶ï¼Œå¯èƒ½é‡å¤æ·»åŠ  property

**ä»£ç ä½ç½®**: `BookViewer.vue` è¡Œ 774-777

```javascript
let title = titleWithoutExt;

// å¦‚æœæ–‡ä»¶åä¸æ˜¯ä»¥ property å¼€å¤´ï¼Œåˆ™æ·»åŠ  property å‰ç¼€
if (property && !titleWithoutExt.startsWith(property)) {
  title = `${property} ${titleWithoutExt}`;
}
```

**å½±å“**:
- å¦‚æœæ–‡ä»¶åæœ¬èº«å·²åŒ…å« propertyï¼Œä¼šå¯¼è‡´é‡å¤
- ä¾‹å¦‚: "4.2" + "4.2 åœ°è´¨ç‰¹å¾.md" â†’ "4.2 4.2 åœ°è´¨ç‰¹å¾"

**å»ºè®®**:
```javascript
// æ”¹è¿›ç‰ˆæœ¬
let title = titleWithoutExt;
// ç§»é™¤æ–‡ä»¶åå¼€å¤´çš„ propertyï¼ˆå¦‚æœå­˜åœ¨ï¼‰
const propertyPattern = new RegExp(`^${property}\\s+`);
title = title.replace(propertyPattern, '');
// ç„¶åç»Ÿä¸€æ·»åŠ  property
if (property) {
  title = `${property} ${title}`;
}
```

### 3. å›¾ç‰‡æ ‡é¢˜è¯†åˆ«ä¸å®Œæ•´

**é—®é¢˜**: å›¾ç‰‡æ ‡é¢˜åªåœ¨å‰ç«¯é€šè¿‡ç®€å•å­—ç¬¦ä¸²åŒ¹é…è¯†åˆ«

**ä»£ç ä½ç½®**: `BookViewer.vue` è¡Œ 978-984

```javascript
const isImage = Boolean(
  item.title.trim().startsWith('å›¾') || 
  (item.numericPrefix && item.numericPrefix.startsWith('å›¾'))
);
```

**å½±å“**:
- åªèƒ½è¯†åˆ«ä»¥"å›¾"å¼€å¤´çš„æ ‡é¢˜
- æ— æ³•è¯†åˆ« "Figure 4.1" æˆ–å…¶ä»–æ ¼å¼
- è¡¨æ ¼æ ‡é¢˜è¯†åˆ«é€»è¾‘ç±»ä¼¼ï¼Œä¹Ÿæœ‰é—®é¢˜

**å»ºè®®**:
```javascript
const isImage = Boolean(
  /^(å›¾|Figure|Fig\.?)\s*\d+/.test(item.title.trim()) ||
  (item.numericPrefix && /^(å›¾|Figure|Fig\.?)/.test(item.numericPrefix))
);

const isTable = Boolean(
  /^(è¡¨|Table|Tab\.?)\s*\d+/.test(item.title.trim()) ||
  (item.numericPrefix && /^(è¡¨|Table|Tab\.?)/.test(item.numericPrefix))
);
```

### 4. å›¾ç›®å½•ä¾èµ–ç« èŠ‚æ ‡é¢˜è§£æ

**é—®é¢˜**: å›¾ç›®å½•ä¾èµ–ä»ç« èŠ‚æ ‡é¢˜ä¸­æå– property

**ä»£ç ä½ç½®**: Watch ç›‘å¬ä¸­æå– property

```javascript
watch([selectedChapter, selectedSection], async ([newChapter, newSection]) => {
  if (newChapter >= 0 && newSection >= 0) {
    const section = selectedBook.value?.chapters[newChapter].sections[newSection];
    if (section && section.title) {
      // ä»æ ‡é¢˜ä¸­æå–ç« èŠ‚å·
      const match = section.title.match(/^(\d+(?:\.\d+)*)/);
      if (match) {
        const property = match[1];
        // è¯·æ±‚å›¾ç‰‡åˆ—è¡¨
        const url = `http://localhost:8080/api/files/chapter/${property}/images?bookId=${bookId}`;
        // ...
      }
    }
  }
});
```

**å½±å“**:
- å¦‚æœæ ‡é¢˜æ ¼å¼å˜åŒ–ï¼Œproperty æå–ä¼šå¤±è´¥
- ä¾èµ–å‰ç«¯å­—ç¬¦ä¸²è§£æï¼Œå®¹æ˜“å‡ºé”™

**å»ºè®®**:
```javascript
// ç›´æ¥ä½¿ç”¨ section.fileId æŸ¥è¯¢å¯¹åº”çš„ property
// æˆ–è€…åœ¨ section å¯¹è±¡ä¸­ç›´æ¥å­˜å‚¨ property
const selectSection = async (chapterIndex, sectionIndex) => {
  // ...
  const section = selectedBook.value?.chapters[chapterIndex].sections[sectionIndex];
  
  // æ–¹æ¡ˆ1: åœ¨æ„å»º section æ—¶ä¿å­˜ property
  if (section && section.property) {
    const url = `http://localhost:8080/api/files/chapter/${section.property}/images`;
    // ...
  }
};
```

### 5. ç›®å½•å±‚çº§å¤„ç†å¤æ‚

**é—®é¢˜**: å‰ç«¯å¤„ç†å¤šçº§ç›®å½•çš„é€»è¾‘å¤æ‚ä¸”å®¹æ˜“å‡ºé”™

**ä»£ç ä½ç½®**: `BookViewer.vue` è¡Œ 1037-1062

```javascript
const hasChildren = (toc, itemIndex) => {
  if (!toc || itemIndex >= toc.length) return false;
  const currentLevel = toc[itemIndex].level;
  return itemIndex < toc.length - 1 && toc[itemIndex + 1].level > currentLevel;
};

const getChildren = (toc, itemIndex) => {
  if (!toc || itemIndex >= toc.length) return [];
  const currentLevel = toc[itemIndex].level;
  const children = [];
  
  for (let i = itemIndex + 1; i < toc.length; i++) {
    if (toc[i].level <= currentLevel) break;
    if (!toc[i].isImage) {
      children.push(toc[i]);
    }
  }
  return children;
};
```

**å½±å“**:
- `getChildren` è¿”å›æ‰€æœ‰æ›´æ·±å±‚çº§çš„é¡¹ï¼Œä¸åŒºåˆ†ç›´æ¥å­é¡¹å’Œå­™å­é¡¹
- å¯¼è‡´ç›®å½•å±‚çº§æ˜¾ç¤ºæ··ä¹±

**å»ºè®®**:
```javascript
// åªè¿”å›ç›´æ¥å­é¡¹
const getDirectChildren = (toc, itemIndex) => {
  if (!toc || itemIndex >= toc.length) return [];
  
  const currentLevel = toc[itemIndex].level;
  const targetLevel = currentLevel + 1;  // åªè¦ä¸‹ä¸€çº§
  const children = [];
  
  for (let i = itemIndex + 1; i < toc.length; i++) {
    if (toc[i].level <= currentLevel) break;  // å›åˆ°åŒçº§æˆ–æ›´é«˜ï¼Œåœæ­¢
    if (toc[i].level === targetLevel && !toc[i].isImage) {  // åªæ”¶é›†ç›´æ¥å­é¡¹
      children.push(toc[i]);
    }
  }
  return children;
};
```

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### 1. ç»Ÿä¸€ Property ç®¡ç†

åˆ›å»ºä¸€ä¸ªå·¥å…·ç±»/å‡½æ•°æ¥å¤„ç† property:

```javascript
// utils/propertyUtils.js
export const PropertyUtils = {
  // éªŒè¯ property æ ¼å¼
  isValid(property) {
    return /^\d+(\.\d+)*$/.test(property);
  },
  
  // æå–ç« èŠ‚å·
  getChapter(property) {
    if (!property || !property.includes('.')) return property;
    return property.split('.')[0];
  },
  
  // æ¯”è¾ƒä¸¤ä¸ª property
  compare(propA, propB) {
    // ... ç»Ÿä¸€çš„æ¯”è¾ƒé€»è¾‘
  },
  
  // ä»æ ‡é¢˜ä¸­æå– property
  extractFromTitle(title) {
    const match = title.match(/^(\d+(?:\.\d+)*)/);
    return match ? match[1] : null;
  }
};
```

### 2. åœ¨ Section å¯¹è±¡ä¸­ä¿å­˜ Property

ä¿®æ”¹å‰ç«¯æ„å»º section çš„é€»è¾‘:

```javascript
sections: files.map(file => ({
  title: `${file.property} ${file.fileName.replace(/\.(md|markdown)$/i, '')}`,
  pageNumber: 1,
  fileId: file.id,
  property: file.property,  // ğŸ†• æ·»åŠ  property å­—æ®µ
  fileName: file.fileName    // ğŸ†• ä¿ç•™åŸå§‹æ–‡ä»¶å
}))
```

### 3. åç«¯æ ‡è®°å›¾ç‰‡/è¡¨æ ¼æ ‡é¢˜

åœ¨ `parseMarkdownToc` ä¸­æ·»åŠ ç±»å‹è¯†åˆ«:

```java
Map<String, Object> heading = new HashMap<>();
heading.put("level", level);
heading.put("title", title);
heading.put("numericPrefix", numericPrefix);

// ğŸ†• æ ‡è®°å†…å®¹ç±»å‹
if (title.matches("^(å›¾|Figure|Fig\\.?)\\s*\\d+.*")) {
    heading.put("contentType", "image");
} else if (title.matches("^(è¡¨|Table|Tab\\.?)\\s*\\d+.*")) {
    heading.put("contentType", "table");
} else {
    heading.put("contentType", "text");
}

toc.add(heading);
```

### 4. æ·»åŠ ç›®å½•ç¼“å­˜æœºåˆ¶

```javascript
// æ·»åŠ æ¸…ç†æœºåˆ¶
const clearOldTocCache = () => {
  if (!selectedBook.value) return;
  
  selectedBook.value.chapters.forEach((chapter, chapterIdx) => {
    chapter.sections.forEach((section, sectionIdx) => {
      // åªä¿ç•™å½“å‰ç« èŠ‚åŠå‰åå„ä¸€ç« çš„ toc
      if (Math.abs(chapterIdx - selectedChapter.value) > 1) {
        section.toc = undefined;
      }
    });
  });
};
```

### 5. æ”¹è¿›é”™è¯¯å¤„ç†

```javascript
const fetchAllMarkdownFiles = async () => {
  try {
    // ...
  } catch (err) {
    console.error('è·å– Markdown æ–‡ä»¶å¤±è´¥:', err);
    
    // æä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
    if (err.response?.status === 404) {
      error.value = 'æœªæ‰¾åˆ°ä¹¦ç±æ•°æ®ï¼Œè¯·æ£€æŸ¥ä¹¦ç± ID æ˜¯å¦æ­£ç¡®';
    } else if (err.response?.status === 500) {
      error.value = 'æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•';
    } else if (!err.response) {
      error.value = 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ';
    } else {
      error.value = `è·å–å¤±è´¥: ${err.message}`;
    }
    
    // æŠ›å‡ºé”™è¯¯ä¾›è°ƒç”¨è€…å¤„ç†
    throw err;
  }
};
```

## ğŸ“ æ€»ç»“

### ä¸»è¦é—®é¢˜
1. **Property ä¾èµ–æ€§**: ç³»ç»Ÿé«˜åº¦ä¾èµ– property å­—æ®µçš„æ ¼å¼å’Œå‡†ç¡®æ€§
2. **å­—ç¬¦ä¸²è§£æè„†å¼±**: å¤§é‡ä½¿ç”¨å­—ç¬¦ä¸²åŒ¹é…å’Œæ­£åˆ™ï¼Œå®¹æ˜“å‡ºé”™
3. **å›¾ç‰‡æ ‡é¢˜è¯†åˆ«**: è¯†åˆ«é€»è¾‘ç®€å•ï¼Œæ— æ³•å¤„ç†å¤šç§æ ¼å¼
4. **å±‚çº§å¤„ç†**: å¤šçº§ç›®å½•çš„å±‚çº§å…³ç³»å¤„ç†ä¸å¤Ÿæ¸…æ™°
5. **ç¼ºå°‘é”™è¯¯å¤„ç†**: è¾¹ç•Œæƒ…å†µå’Œå¼‚å¸¸å¤„ç†ä¸è¶³

### æ”¹è¿›æ–¹å‘
1. ç»Ÿä¸€ property ç®¡ç†å’ŒéªŒè¯
2. åœ¨æ•°æ®ç»“æ„ä¸­ä¿ç•™æ›´å¤šå…ƒä¿¡æ¯
3. åç«¯å¢å¼ºå†…å®¹ç±»å‹è¯†åˆ«
4. ç®€åŒ–å‰ç«¯å±‚çº§å¤„ç†é€»è¾‘
5. å¢å¼ºé”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º

---

ç”Ÿæˆæ—¶é—´: 2025-11-19
