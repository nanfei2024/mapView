# ğŸ“š æ–‡æ¡£æ•°å­—åŒ–ä¸æ–‡ä»¶ç®¡ç†é›†æˆæ–¹æ¡ˆ

## ğŸ¯ éœ€æ±‚æ¦‚è¿°

### ä¸šåŠ¡æµç¨‹
```
ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£
    â†“
åœ°è´¨æ–‡æ¡£æ•°å­—åŒ–å¤„ç†ï¼ˆMinerU APIï¼‰
    â†“
å¤„ç†å®Œæˆåè‡ªåŠ¨ä¿å­˜
    â†“
æ ¹æ®æ–‡ä»¶ç±»å‹åˆ†æµä¿å­˜ï¼š
    - ğŸ“„ æ–‡æ¡£ â†’ æ–‡ä»¶åˆ—è¡¨
    - ğŸ–¼ï¸ å›¾ç‰‡ â†’ æˆ‘çš„å›¾åº“
    - ğŸ“Š è¡¨æ ¼ â†’ æˆ‘çš„è¡¨åº“
    â†“
ç”¨æˆ·åœ¨æ–‡ä»¶ç®¡ç†ä¸­å¿ƒæŸ¥çœ‹
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ–¹æ¡ˆä¸€ï¼šä¸‰ä¸ªç‹¬ç«‹æ•°æ®åº“ï¼ˆæ¨èï¼‰

#### 1. æ–‡æ¡£æ•°æ®åº“ (documents_db)
```sql
-- æ–‡æ¡£è¡¨
CREATE TABLE documents (
    id VARCHAR(50) PRIMARY KEY,
    file_name VARCHAR(255) NOT NULL,
    file_type VARCHAR(50),
    file_size BIGINT,
    original_url TEXT,
    result_url TEXT,
    markdown_content LONGTEXT,
    source VARCHAR(50), -- 'upload' | 'digitalization'
    status VARCHAR(20), -- 'pending' | 'processing' | 'completed' | 'error'
    error_message TEXT,
    metadata JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_file_type (file_type),
    INDEX idx_status (status),
    INDEX idx_source (source),
    INDEX idx_created_at (created_at)
);
```

#### 2. å›¾ç‰‡æ•°æ®åº“ (images_db)
```sql
-- å›¾ç‰‡è¡¨
CREATE TABLE images (
    id VARCHAR(50) PRIMARY KEY,
    image_name VARCHAR(255) NOT NULL,
    image_url TEXT NOT NULL,
    thumbnail_url TEXT,
    category VARCHAR(50), -- 'åœ°è²Œ' | 'åœ°è´¨' | 'çŸ¿ç‰©' | 'åŒ–çŸ³' | 'å…¶ä»–'
    file_size BIGINT,
    width INT,
    height INT,
    format VARCHAR(20), -- 'jpg' | 'png' | 'gif' | 'svg'
    source VARCHAR(50), -- 'upload' | 'digitalization' | 'extract'
    source_document_id VARCHAR(50), -- æ¥æºæ–‡æ¡£ID
    tags JSON, -- æ ‡ç­¾æ•°ç»„
    metadata JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_category (category),
    INDEX idx_source (source),
    INDEX idx_source_document (source_document_id),
    INDEX idx_created_at (created_at)
);
```

#### 3. è¡¨æ ¼æ•°æ®åº“ (tables_db)
```sql
-- è¡¨æ ¼è¡¨
CREATE TABLE tables (
    id VARCHAR(50) PRIMARY KEY,
    table_name VARCHAR(255) NOT NULL,
    description TEXT,
    category VARCHAR(50), -- 'åœ°è´¨æ•°æ®' | 'çŸ¿ç‰©æˆåˆ†' | 'åœ°è²Œç‰¹å¾' | 'æ¿å—è¿åŠ¨' | 'å…¶ä»–'
    table_type VARCHAR(20), -- 'Excel' | 'CSV' | 'JSON'
    file_url TEXT NOT NULL,
    file_size BIGINT,
    row_count INT,
    column_count INT,
    columns JSON, -- åˆ—åæ•°ç»„
    preview_data JSON, -- å‰10è¡Œæ•°æ®é¢„è§ˆ
    source VARCHAR(50), -- 'upload' | 'digitalization' | 'extract'
    source_document_id VARCHAR(50), -- æ¥æºæ–‡æ¡£ID
    metadata JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_category (category),
    INDEX idx_table_type (table_type),
    INDEX idx_source (source),
    INDEX idx_source_document (source_document_id),
    INDEX idx_created_at (created_at)
);
```

---

## ğŸ”Œ åç«¯APIè®¾è®¡

### åŸºç¡€URL
```
å¼€å‘ç¯å¢ƒ: http://localhost:8080/api
ç”Ÿäº§ç¯å¢ƒ: https://your-domain.com/api
```

---

## ğŸ“„ æ–‡æ¡£ç®¡ç† API

### 1. åˆ›å»ºæ–‡æ¡£è®°å½•ï¼ˆä»æ•°å­—åŒ–é¡µé¢ï¼‰
```http
POST /api/documents/from-digitalization

Content-Type: application/json

{
  "fileName": "åœ°è´¨æŠ¥å‘Š.pdf",
  "fileType": "pdf",
  "fileSize": 2548000,
  "originalUrl": "https://example.com/source.pdf",
  "resultUrl": "https://oss.example.com/result.zip",
  "mineruTaskId": "task_123456",
  "status": "completed"
}

Response 200:
{
  "code": 0,
  "msg": "æ–‡æ¡£ä¿å­˜æˆåŠŸ",
  "data": {
    "documentId": "doc_20251109_001",
    "extractedImages": 5,  // æå–çš„å›¾ç‰‡æ•°é‡
    "extractedTables": 3   // æå–çš„è¡¨æ ¼æ•°é‡
  }
}
```

### 2. è·å–æ–‡æ¡£åˆ—è¡¨
```http
GET /api/documents?page=1&pageSize=10&fileType=pdf&source=digitalization

Response 200:
{
  "code": 0,
  "msg": "success",
  "data": {
    "records": [
      {
        "id": "doc_20251109_001",
        "fileName": "åœ°è´¨æŠ¥å‘Š.pdf",
        "fileType": "pdf",
        "fileSize": 2548000,
        "status": "completed",
        "source": "digitalization",
        "resultUrl": "https://oss.example.com/result.zip",
        "createdAt": "2025-11-09 10:30:00",
        "updatedAt": "2025-11-09 10:35:00"
      }
    ],
    "total": 50,
    "page": 1,
    "pageSize": 10
  }
}
```

### 3. è·å–æ–‡æ¡£è¯¦æƒ…ï¼ˆåŒ…å«æå–çš„å›¾ç‰‡å’Œè¡¨æ ¼ï¼‰
```http
GET /api/documents/{id}/details

Response 200:
{
  "code": 0,
  "msg": "success",
  "data": {
    "document": {
      "id": "doc_20251109_001",
      "fileName": "åœ°è´¨æŠ¥å‘Š.pdf",
      "fileType": "pdf",
      "fileSize": 2548000,
      "originalUrl": "https://example.com/source.pdf",
      "resultUrl": "https://oss.example.com/result.zip",
      "markdownContent": "# æ ‡é¢˜\nå†…å®¹...",
      "status": "completed",
      "createdAt": "2025-11-09 10:30:00"
    },
    "extractedImages": [
      {
        "id": "img_001",
        "imageName": "figure_1.jpg",
        "imageUrl": "https://oss.example.com/img_001.jpg",
        "category": "åœ°è²Œ",
        "fileSize": 458000
      }
    ],
    "extractedTables": [
      {
        "id": "tbl_001",
        "tableName": "åœ°è´¨æ•°æ®ç»Ÿè®¡è¡¨",
        "tableType": "CSV",
        "fileUrl": "https://oss.example.com/tbl_001.csv",
        "rowCount": 156,
        "columnCount": 12
      }
    ]
  }
}
```

### 4. ä¸‹è½½æ–‡æ¡£
```http
GET /api/documents/{id}/download

Response 200:
Content-Type: application/octet-stream
Content-Disposition: attachment; filename="åœ°è´¨æŠ¥å‘Š.pdf"
```

---

## ğŸ–¼ï¸ å›¾åº“ç®¡ç† API

### 1. ä¿å­˜æå–çš„å›¾ç‰‡ï¼ˆè‡ªåŠ¨è°ƒç”¨ï¼‰
```http
POST /api/images/from-extraction

Content-Type: application/json

{
  "sourceDocumentId": "doc_20251109_001",
  "images": [
    {
      "imageName": "figure_1.jpg",
      "imageUrl": "https://oss.example.com/img_001.jpg",
      "thumbnailUrl": "https://oss.example.com/thumb_001.jpg",
      "category": "åœ°è²Œ",
      "fileSize": 458000,
      "width": 1920,
      "height": 1080,
      "format": "jpg"
    }
  ]
}

Response 200:
{
  "code": 0,
  "msg": "å›¾ç‰‡ä¿å­˜æˆåŠŸ",
  "data": {
    "savedCount": 1,
    "imageIds": ["img_001"]
  }
}
```

### 2. ä¸Šä¼ å›¾ç‰‡
```http
POST /api/images/upload

Content-Type: multipart/form-data

file: <binary>
category: åœ°è´¨
tags: ["æ¿å—", "æ„é€ "]

Response 200:
{
  "code": 0,
  "msg": "ä¸Šä¼ æˆåŠŸ",
  "data": {
    "imageId": "img_002",
    "imageUrl": "https://oss.example.com/img_002.jpg",
    "thumbnailUrl": "https://oss.example.com/thumb_002.jpg"
  }
}
```

### 3. è·å–å›¾ç‰‡åˆ—è¡¨
```http
GET /api/images?page=1&pageSize=12&category=åœ°è²Œ&source=extraction

Response 200:
{
  "code": 0,
  "msg": "success",
  "data": {
    "records": [
      {
        "id": "img_001",
        "imageName": "äºšæ´²åœ°è²Œåœˆ.jpg",
        "imageUrl": "https://oss.example.com/img_001.jpg",
        "thumbnailUrl": "https://oss.example.com/thumb_001.jpg",
        "category": "åœ°è²Œ",
        "fileSize": 2548000,
        "width": 1920,
        "height": 1080,
        "format": "jpg",
        "source": "extraction",
        "sourceDocumentId": "doc_20251109_001",
        "tags": ["æ¿å—", "æ„é€ "],
        "createdAt": "2025-11-09 10:30:00"
      }
    ],
    "total": 50,
    "page": 1,
    "pageSize": 12
  }
}
```

### 4. åˆ é™¤å›¾ç‰‡
```http
DELETE /api/images/{id}

Response 200:
{
  "code": 0,
  "msg": "åˆ é™¤æˆåŠŸ"
}
```

### 5. æ‰¹é‡åˆ é™¤å›¾ç‰‡
```http
POST /api/images/batch-delete

Content-Type: application/json

{
  "imageIds": ["img_001", "img_002", "img_003"]
}

Response 200:
{
  "code": 0,
  "msg": "æ‰¹é‡åˆ é™¤æˆåŠŸ",
  "data": {
    "deletedCount": 3
  }
}
```

---

## ğŸ“Š è¡¨åº“ç®¡ç† API

### 1. ä¿å­˜æå–çš„è¡¨æ ¼ï¼ˆè‡ªåŠ¨è°ƒç”¨ï¼‰
```http
POST /api/tables/from-extraction

Content-Type: application/json

{
  "sourceDocumentId": "doc_20251109_001",
  "tables": [
    {
      "tableName": "åœ°è´¨æ•°æ®ç»Ÿè®¡è¡¨",
      "description": "åŒ…å«äºšæ´²ä¸»è¦åœ°è´¨æ¿å—çš„åˆ†å¸ƒã€é¢ç§¯ã€è¿åŠ¨é€Ÿåº¦ç­‰è¯¦ç»†æ•°æ®",
      "category": "åœ°è´¨æ•°æ®",
      "tableType": "CSV",
      "fileUrl": "https://oss.example.com/tbl_001.csv",
      "fileSize": 458000,
      "rowCount": 156,
      "columnCount": 12,
      "columns": ["æ¿å—åç§°", "é¢ç§¯", "è¿åŠ¨é€Ÿåº¦", "..."],
      "previewData": [...]
    }
  ]
}

Response 200:
{
  "code": 0,
  "msg": "è¡¨æ ¼ä¿å­˜æˆåŠŸ",
  "data": {
    "savedCount": 1,
    "tableIds": ["tbl_001"]
  }
}
```

### 2. å¯¼å…¥è¡¨æ ¼
```http
POST /api/tables/import

Content-Type: multipart/form-data

file: <binary>
tableName: åœ°è´¨æ•°æ®ç»Ÿè®¡è¡¨
category: åœ°è´¨æ•°æ®
description: è¯¦ç»†æè¿°...

Response 200:
{
  "code": 0,
  "msg": "å¯¼å…¥æˆåŠŸ",
  "data": {
    "tableId": "tbl_002",
    "fileUrl": "https://oss.example.com/tbl_002.xlsx",
    "rowCount": 200,
    "columnCount": 15
  }
}
```

### 3. è·å–è¡¨æ ¼åˆ—è¡¨
```http
GET /api/tables?page=1&pageSize=9&category=åœ°è´¨æ•°æ®&tableType=CSV

Response 200:
{
  "code": 0,
  "msg": "success",
  "data": {
    "records": [
      {
        "id": "tbl_001",
        "tableName": "äºšæ´²åœ°è´¨æ¿å—æ•°æ®ç»Ÿè®¡è¡¨",
        "description": "åŒ…å«äºšæ´²ä¸»è¦åœ°è´¨æ¿å—çš„åˆ†å¸ƒã€é¢ç§¯ã€è¿åŠ¨é€Ÿåº¦ç­‰è¯¦ç»†æ•°æ®",
        "category": "åœ°è´¨æ•°æ®",
        "tableType": "Excel",
        "fileUrl": "https://oss.example.com/tbl_001.xlsx",
        "fileSize": 458000,
        "rowCount": 156,
        "columnCount": 12,
        "source": "extraction",
        "sourceDocumentId": "doc_20251109_001",
        "createdAt": "2025-11-09 10:30:00",
        "updatedAt": "2025-11-09 10:30:00"
      }
    ],
    "total": 25,
    "page": 1,
    "pageSize": 9
  }
}
```

### 4. è·å–è¡¨æ ¼è¯¦æƒ…ï¼ˆåŒ…å«é¢„è§ˆæ•°æ®ï¼‰
```http
GET /api/tables/{id}/details

Response 200:
{
  "code": 0,
  "msg": "success",
  "data": {
    "id": "tbl_001",
    "tableName": "äºšæ´²åœ°è´¨æ¿å—æ•°æ®ç»Ÿè®¡è¡¨",
    "description": "åŒ…å«äºšæ´²ä¸»è¦åœ°è´¨æ¿å—çš„åˆ†å¸ƒã€é¢ç§¯ã€è¿åŠ¨é€Ÿåº¦ç­‰è¯¦ç»†æ•°æ®",
    "category": "åœ°è´¨æ•°æ®",
    "tableType": "Excel",
    "fileUrl": "https://oss.example.com/tbl_001.xlsx",
    "fileSize": 458000,
    "rowCount": 156,
    "columnCount": 12,
    "columns": ["æ¿å—åç§°", "é¢ç§¯(kmÂ²)", "è¿åŠ¨é€Ÿåº¦(cm/å¹´)", "..."],
    "previewData": [
      ["å¤ªå¹³æ´‹æ¿å—", "103000000", "8.5", "..."],
      ["æ¬§äºšæ¿å—", "67800000", "2.1", "..."]
    ],
    "sourceDocument": {
      "id": "doc_20251109_001",
      "fileName": "åœ°è´¨æŠ¥å‘Š.pdf"
    },
    "createdAt": "2025-11-09 10:30:00"
  }
}
```

### 5. ä¸‹è½½è¡¨æ ¼
```http
GET /api/tables/{id}/download

Response 200:
Content-Type: application/octet-stream
Content-Disposition: attachment; filename="åœ°è´¨æ•°æ®ç»Ÿè®¡è¡¨.xlsx"
```

---

## ğŸ”„ æ•°æ®æµé›†æˆ

### å‰ç«¯å¤„ç†æµç¨‹

#### æ–‡æ¡£æ•°å­—åŒ–é¡µé¢ (`DocumentDigitalizationPage.vue`)

```typescript
// 1. æ–‡æ¡£å¤„ç†å®Œæˆåçš„å›è°ƒ
const handleProcessComplete = async (file: UploadedFile) => {
  try {
    // ä¿å­˜æ–‡æ¡£åˆ°æ–‡ä»¶ç®¡ç†
    const response = await axios.post('/api/documents/from-digitalization', {
      fileName: file.name,
      fileType: file.type,
      fileSize: file.size,
      originalUrl: file.sourceUrl,
      resultUrl: file.resultUrl,
      mineruTaskId: file.taskId,
      status: 'completed'
    });

    if (response.data.code === 0) {
      const { documentId, extractedImages, extractedTables } = response.data.data;
      
      // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
      ElMessage.success({
        message: `æ–‡æ¡£å·²ä¿å­˜ï¼æå–äº† ${extractedImages} å¼ å›¾ç‰‡å’Œ ${extractedTables} ä¸ªè¡¨æ ¼`,
        duration: 5000
      });

      // è¯¢é—®ç”¨æˆ·æ˜¯å¦æŸ¥çœ‹
      ElMessageBox.confirm(
        `æ–‡æ¡£"${file.name}"å·²æˆåŠŸä¿å­˜åˆ°æ–‡ä»¶ç®¡ç†ä¸­å¿ƒã€‚æ˜¯å¦ç«‹å³æŸ¥çœ‹ï¼Ÿ`,
        'ä¿å­˜æˆåŠŸ',
        {
          confirmButtonText: 'ç«‹å³æŸ¥çœ‹',
          cancelButtonText: 'ç»§ç»­å¤„ç†',
          type: 'success'
        }
      ).then(() => {
        // è·³è½¬åˆ°æ–‡ä»¶ç®¡ç†ä¸­å¿ƒå¹¶é«˜äº®æ˜¾ç¤ºæ–°æ–‡æ¡£
        router.push({
          path: '/file-list',
          query: { highlight: documentId }
        });
      }).catch(() => {
        // ç”¨æˆ·é€‰æ‹©ç»§ç»­å¤„ç†
      });
    }
  } catch (error) {
    console.error('ä¿å­˜æ–‡æ¡£å¤±è´¥:', error);
    ElMessage.error('ä¿å­˜åˆ°æ–‡ä»¶ç®¡ç†å¤±è´¥');
  }
};

// 2. åœ¨ä»»åŠ¡å®Œæˆåè°ƒç”¨
const processAllFiles = async () => {
  for (const file of uploadedFiles.value) {
    if (file.status === 'pending') {
      file.status = 'processing';
      
      try {
        // ... MinerU API å¤„ç†é€»è¾‘ ...
        
        // å¤„ç†å®Œæˆå
        file.status = 'completed';
        
        // ä¿å­˜åˆ°æ–‡ä»¶ç®¡ç†
        await handleProcessComplete(file);
      } catch (error) {
        file.status = 'error';
      }
    }
  }
};
```

#### æ–‡ä»¶ç®¡ç†é¡µé¢ï¼ˆé«˜äº®æ–°æ–‡æ¡£ï¼‰

```typescript
// FileListPage.vue
import { useRoute } from 'vue-router';

const route = useRoute();

onMounted(async () => {
  // è·å–è¦é«˜äº®æ˜¾ç¤ºçš„æ–‡æ¡£ID
  const highlightId = route.query.highlight as string;
  
  if (highlightId) {
    // åˆ‡æ¢åˆ°æ–‡ä»¶åˆ—è¡¨æ ‡ç­¾
    activeTab.value = 'files';
    
    // ç­‰å¾…ç»„ä»¶åŠ è½½
    await nextTick();
    
    // æ»šåŠ¨åˆ°è¯¥æ–‡æ¡£å¹¶é«˜äº®æ˜¾ç¤º
    const element = document.querySelector(`[data-document-id="${highlightId}"]`);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth', block: 'center' });
      element.classList.add('highlight-new');
      
      // 3ç§’åç§»é™¤é«˜äº®
      setTimeout(() => {
        element.classList.remove('highlight-new');
      }, 3000);
    }
  }
});
```

#### å›¾åº“ç»„ä»¶ï¼ˆæ˜¾ç¤ºæ¥æºï¼‰

```typescript
// ImageGallery.vue
interface ImageData {
  id: string;
  imageName: string;
  imageUrl: string;
  category: string;
  fileSize: number;
  source: 'upload' | 'extraction'; // æ¥æº
  sourceDocumentId?: string; // æ¥æºæ–‡æ¡£ID
  sourceDocumentName?: string; // æ¥æºæ–‡æ¡£åç§°
  uploadTime: string;
}

// æ˜¾ç¤ºå›¾ç‰‡æ¥æº
const getImageSource = (image: ImageData) => {
  if (image.source === 'extraction' && image.sourceDocumentName) {
    return `æ¥è‡ªæ–‡æ¡£ï¼š${image.sourceDocumentName}`;
  }
  return 'æ‰‹åŠ¨ä¸Šä¼ ';
};
```

#### è¡¨åº“ç»„ä»¶ï¼ˆæ˜¾ç¤ºæ¥æºï¼‰

```typescript
// TableLibrary.vue
interface TableData {
  id: string;
  tableName: string;
  description: string;
  category: string;
  tableType: string;
  rowCount: number;
  columnCount: number;
  fileSize: number;
  source: 'upload' | 'extraction'; // æ¥æº
  sourceDocumentId?: string;
  sourceDocumentName?: string;
  updateTime: string;
}

// æ˜¾ç¤ºè¡¨æ ¼æ¥æº
const getTableSource = (table: TableData) => {
  if (table.source === 'extraction' && table.sourceDocumentName) {
    return `æå–è‡ªï¼š${table.sourceDocumentName}`;
  }
  return 'æ‰‹åŠ¨å¯¼å…¥';
};
```

---

## ğŸ” ç¯å¢ƒå˜é‡é…ç½®

### `.env.development`
```env
# APIåŸºç¡€URL
VITE_API_BASE_URL=http://localhost:8080/api

# æ–‡æ¡£æœåŠ¡
VITE_DOCUMENT_API=http://localhost:8080/api/documents

# å›¾åº“æœåŠ¡
VITE_IMAGE_API=http://localhost:8081/api/images

# è¡¨åº“æœåŠ¡
VITE_TABLE_API=http://localhost:8082/api/tables

# MinerU API
VITE_MINERU_API_BASE=https://mineru.net/api/v4
VITE_MINERU_API_TOKEN=your_token_here
```

### `.env.production`
```env
# APIåŸºç¡€URL
VITE_API_BASE_URL=https://api.your-domain.com/api

# æ–‡æ¡£æœåŠ¡
VITE_DOCUMENT_API=https://api.your-domain.com/api/documents

# å›¾åº“æœåŠ¡
VITE_IMAGE_API=https://api.your-domain.com/api/images

# è¡¨åº“æœåŠ¡
VITE_TABLE_API=https://api.your-domain.com/api/tables

# MinerU API
VITE_MINERU_API_BASE=https://mineru.net/api/v4
VITE_MINERU_API_TOKEN=your_production_token_here
```

---

## ğŸ“¦ APIå®¢æˆ·ç«¯å°è£…

### `src/api/client.ts`
```typescript
import axios from 'axios';

// åˆ›å»ºä¸åŒæœåŠ¡çš„å®¢æˆ·ç«¯
export const documentClient = axios.create({
  baseURL: import.meta.env.VITE_DOCUMENT_API || 'http://localhost:8080/api/documents',
  timeout: 30000
});

export const imageClient = axios.create({
  baseURL: import.meta.env.VITE_IMAGE_API || 'http://localhost:8081/api/images',
  timeout: 30000
});

export const tableClient = axios.create({
  baseURL: import.meta.env.VITE_TABLE_API || 'http://localhost:8082/api/tables',
  timeout: 30000
});

// è¯·æ±‚æ‹¦æˆªå™¨
const setupInterceptors = (client: typeof axios) => {
  client.interceptors.request.use(
    config => {
      // æ·»åŠ token
      const token = localStorage.getItem('token');
      if (token) {
        config.headers.Authorization = `Bearer ${token}`;
      }
      return config;
    },
    error => Promise.reject(error)
  );

  client.interceptors.response.use(
    response => response,
    error => {
      if (error.response?.status === 401) {
        // æœªæˆæƒï¼Œè·³è½¬ç™»å½•
        window.location.href = '/login';
      }
      return Promise.reject(error);
    }
  );
};

// ä¸ºæ‰€æœ‰å®¢æˆ·ç«¯è®¾ç½®æ‹¦æˆªå™¨
setupInterceptors(documentClient);
setupInterceptors(imageClient);
setupInterceptors(tableClient);
```

### `src/api/documentService.ts`
```typescript
import { documentClient } from './client';

export const documentService = {
  // ä»æ•°å­—åŒ–ä¿å­˜æ–‡æ¡£
  saveFromDigitalization(data: {
    fileName: string;
    fileType: string;
    fileSize: number;
    originalUrl: string;
    resultUrl: string;
    mineruTaskId: string;
    status: string;
  }) {
    return documentClient.post('/from-digitalization', data);
  },

  // è·å–æ–‡æ¡£åˆ—è¡¨
  getDocuments(params: {
    page: number;
    pageSize: number;
    fileType?: string;
    source?: string;
  }) {
    return documentClient.get('/', { params });
  },

  // è·å–æ–‡æ¡£è¯¦æƒ…
  getDocumentDetails(id: string) {
    return documentClient.get(`/${id}/details`);
  },

  // åˆ é™¤æ–‡æ¡£
  deleteDocument(id: string) {
    return documentClient.delete(`/${id}`);
  },

  // æ‰¹é‡åˆ é™¤
  batchDelete(ids: string[]) {
    return documentClient.post('/batch-delete', { documentIds: ids });
  }
};
```

### `src/api/imageService.ts`
```typescript
import { imageClient } from './client';

export const imageService = {
  // ä»æå–ä¿å­˜å›¾ç‰‡
  saveFromExtraction(data: {
    sourceDocumentId: string;
    images: any[];
  }) {
    return imageClient.post('/from-extraction', data);
  },

  // ä¸Šä¼ å›¾ç‰‡
  uploadImage(file: File, category: string, tags?: string[]) {
    const formData = new FormData();
    formData.append('file', file);
    formData.append('category', category);
    if (tags) {
      formData.append('tags', JSON.stringify(tags));
    }
    return imageClient.post('/upload', formData);
  },

  // è·å–å›¾ç‰‡åˆ—è¡¨
  getImages(params: {
    page: number;
    pageSize: number;
    category?: string;
    source?: string;
  }) {
    return imageClient.get('/', { params });
  },

  // åˆ é™¤å›¾ç‰‡
  deleteImage(id: string) {
    return imageClient.delete(`/${id}`);
  },

  // æ‰¹é‡åˆ é™¤
  batchDelete(ids: string[]) {
    return imageClient.post('/batch-delete', { imageIds: ids });
  }
};
```

### `src/api/tableService.ts`
```typescript
import { tableClient } from './client';

export const tableService = {
  // ä»æå–ä¿å­˜è¡¨æ ¼
  saveFromExtraction(data: {
    sourceDocumentId: string;
    tables: any[];
  }) {
    return tableClient.post('/from-extraction', data);
  },

  // å¯¼å…¥è¡¨æ ¼
  importTable(file: File, data: {
    tableName: string;
    category: string;
    description?: string;
  }) {
    const formData = new FormData();
    formData.append('file', file);
    formData.append('tableName', data.tableName);
    formData.append('category', data.category);
    if (data.description) {
      formData.append('description', data.description);
    }
    return tableClient.post('/import', formData);
  },

  // è·å–è¡¨æ ¼åˆ—è¡¨
  getTables(params: {
    page: number;
    pageSize: number;
    category?: string;
    tableType?: string;
  }) {
    return tableClient.get('/', { params });
  },

  // è·å–è¡¨æ ¼è¯¦æƒ…
  getTableDetails(id: string) {
    return tableClient.get(`/${id}/details`);
  },

  // åˆ é™¤è¡¨æ ¼
  deleteTable(id: string) {
    return tableClient.delete(`/${id}`);
  },

  // æ‰¹é‡åˆ é™¤
  batchDelete(ids: string[]) {
    return tableClient.post('/batch-delete', { tableIds: ids });
  }
};
```

---

## ğŸ¯ å®Œæ•´æ•°æ®æµç¤ºä¾‹

### åœºæ™¯ï¼šç”¨æˆ·ä¸Šä¼ PDFæ–‡æ¡£è¿›è¡Œæ•°å­—åŒ–

```typescript
// 1. ç”¨æˆ·åœ¨æ–‡æ¡£æ•°å­—åŒ–é¡µé¢ä¸Šä¼ PDF
const handleFileUpload = async (file: File) => {
  // è°ƒç”¨MinerU APIå¤„ç†
  const taskResponse = await mineruApi.createExtractTask(fileUrl);
  const taskId = taskResponse.data.task_id;
  
  // è½®è¯¢ä»»åŠ¡çŠ¶æ€
  const result = await pollTaskUntilComplete(taskId);
  
  if (result.state === 'done') {
    // 2. å¤„ç†å®Œæˆï¼Œä¿å­˜åˆ°æ–‡ä»¶ç®¡ç†
    const saveResponse = await documentService.saveFromDigitalization({
      fileName: file.name,
      fileType: 'pdf',
      fileSize: file.size,
      originalUrl: fileUrl,
      resultUrl: result.full_zip_url,
      mineruTaskId: taskId,
      status: 'completed'
    });
    
    const { documentId, extractedImages, extractedTables } = saveResponse.data.data;
    
    // 3. åç«¯è‡ªåŠ¨æå–ZIPä¸­çš„å›¾ç‰‡å’Œè¡¨æ ¼
    // åç«¯ä¼šè°ƒç”¨ï¼š
    // - imageService.saveFromExtraction() ä¿å­˜å›¾ç‰‡åˆ°å›¾åº“
    // - tableService.saveFromExtraction() ä¿å­˜è¡¨æ ¼åˆ°è¡¨åº“
    
    // 4. æç¤ºç”¨æˆ·å¹¶è¯¢é—®æ˜¯å¦æŸ¥çœ‹
    ElMessageBox.confirm(
      `å¤„ç†å®Œæˆï¼\n` +
      `- æ–‡æ¡£å·²ä¿å­˜åˆ°æ–‡ä»¶åˆ—è¡¨\n` +
      `- æå–äº† ${extractedImages} å¼ å›¾ç‰‡åˆ°å›¾åº“\n` +
      `- æå–äº† ${extractedTables} ä¸ªè¡¨æ ¼åˆ°è¡¨åº“\n\n` +
      `æ˜¯å¦ç«‹å³æŸ¥çœ‹ï¼Ÿ`,
      'æ•°å­—åŒ–å®Œæˆ',
      {
        confirmButtonText: 'æŸ¥çœ‹æ–‡ä»¶ç®¡ç†',
        cancelButtonText: 'ç»§ç»­å¤„ç†',
        type: 'success'
      }
    ).then(() => {
      // 5. è·³è½¬åˆ°æ–‡ä»¶ç®¡ç†ä¸­å¿ƒ
      router.push({
        path: '/file-list',
        query: { highlight: documentId }
      });
    });
  }
};
```

---

## ğŸ“Š åç«¯å¤„ç†é€»è¾‘

### æ–‡æ¡£ä¿å­˜åçš„è‡ªåŠ¨å¤„ç†

```python
# Pythonç¤ºä¾‹ï¼ˆåç«¯ï¼‰
from zipfile import ZipFile
import os

def process_digitalization_result(document_id, result_zip_url):
    """
    å¤„ç†æ•°å­—åŒ–ç»“æœZIPæ–‡ä»¶
    1. ä¸‹è½½ZIP
    2. æå–å›¾ç‰‡ä¿å­˜åˆ°å›¾åº“
    3. æå–è¡¨æ ¼ä¿å­˜åˆ°è¡¨åº“
    """
    # 1. ä¸‹è½½ZIPæ–‡ä»¶
    zip_path = download_file(result_zip_url)
    
    extracted_images = []
    extracted_tables = []
    
    # 2. è§£å‹å¹¶åˆ†ç±»å¤„ç†
    with ZipFile(zip_path, 'r') as zip_file:
        for file_info in zip_file.namelist():
            # æå–å›¾ç‰‡
            if file_info.endswith(('.jpg', '.png', '.gif', '.svg')):
                image_data = extract_and_upload_image(
                    zip_file, 
                    file_info, 
                    document_id
                )
                if image_data:
                    extracted_images.append(image_data)
            
            # æå–è¡¨æ ¼
            elif file_info.endswith(('.csv', '.xlsx', '.json')):
                table_data = extract_and_upload_table(
                    zip_file, 
                    file_info, 
                    document_id
                )
                if table_data:
                    extracted_tables.append(table_data)
    
    # 3. æ‰¹é‡ä¿å­˜åˆ°æ•°æ®åº“
    if extracted_images:
        save_images_to_db(document_id, extracted_images)
    
    if extracted_tables:
        save_tables_to_db(document_id, extracted_tables)
    
    return {
        'extracted_images': len(extracted_images),
        'extracted_tables': len(extracted_tables)
    }
```

---

## ğŸ¨ å‰ç«¯UIå¢å¼º

### æ˜¾ç¤ºæ–‡æ¡£æ¥æºæ ‡ç­¾

```vue
<!-- ImageGallery.vue -->
<div class="image-card">
  <div class="image-badge" v-if="image.source === 'extraction'">
    <span class="badge-icon">ğŸ“„</span>
    <span class="badge-text">æ¥è‡ªæ–‡æ¡£</span>
  </div>
  <!-- ... -->
</div>

<style>
.image-badge {
  position: absolute;
  top: 42px;
  left: 12px;
  padding: 4px 8px;
  background: rgba(102, 126, 234, 0.9);
  color: white;
  border-radius: 4px;
  font-size: 11px;
  display: flex;
  align-items: center;
  gap: 4px;
  z-index: 10;
}
</style>
```

---

## ğŸ¯ æ€»ç»“

### å®ç°è¦ç‚¹

1. **ä¸‰ä¸ªç‹¬ç«‹æ•°æ®åº“**
   - documents_db - å­˜å‚¨æ–‡æ¡£
   - images_db - å­˜å‚¨å›¾ç‰‡
   - tables_db - å­˜å‚¨è¡¨æ ¼

2. **è‡ªåŠ¨åŒ–æµç¨‹**
   - æ–‡æ¡£æ•°å­—åŒ–å®Œæˆåè‡ªåŠ¨ä¿å­˜
   - åç«¯è‡ªåŠ¨æå–å›¾ç‰‡å’Œè¡¨æ ¼
   - å‰ç«¯å®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦

3. **æ•°æ®å…³è”**
   - å›¾ç‰‡å’Œè¡¨æ ¼è®°å½•æ¥æºæ–‡æ¡£ID
   - æ”¯æŒæº¯æºæŸ¥è¯¢
   - æ”¯æŒæ‰¹é‡ç®¡ç†

4. **ç”¨æˆ·ä½“éªŒ**
   - å¤„ç†å®Œæˆåæç¤ºç”¨æˆ·
   - æ”¯æŒå¿«é€Ÿè·³è½¬æŸ¥çœ‹
   - é«˜äº®æ˜¾ç¤ºæ–°å¢å†…å®¹

---

## ğŸ“ åç»­å¼€å‘æ­¥éª¤

1. âœ… **å‰ç«¯å‡†å¤‡**ï¼ˆå·²å®Œæˆï¼‰
   - æ–‡ä»¶ç®¡ç†ä¸­å¿ƒé¡µé¢
   - ä¸‰ä¸ªæ ‡ç­¾é¡µç»„ä»¶
   - APIæ¥å£å°è£…

2. â³ **åç«¯å¼€å‘**ï¼ˆå¾…å®ç°ï¼‰
   - åˆ›å»ºä¸‰ä¸ªæ•°æ®åº“
   - å®ç°APIæ¥å£
   - ZIPæ–‡ä»¶è§£æå’Œåˆ†ç±»å­˜å‚¨

3. â³ **é›†æˆæµ‹è¯•**
   - ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•
   - æ€§èƒ½ä¼˜åŒ–
   - é”™è¯¯å¤„ç†

4. â³ **ä¸Šçº¿éƒ¨ç½²**
   - ç¯å¢ƒé…ç½®
   - æ•°æ®åº“è¿ç§»
   - æœåŠ¡ç›‘æ§

---

**è¿™ä»½æ–¹æ¡ˆä¸ºæ‚¨çš„åç«¯å¯¹æ¥æä¾›äº†å®Œæ•´çš„APIè®¾è®¡å’Œæ•°æ®æµè¯´æ˜ï¼** ğŸ‰

