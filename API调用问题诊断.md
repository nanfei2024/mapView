# ğŸ” MinerU API è°ƒç”¨é—®é¢˜è¯Šæ–­

## ğŸ“‹ é—®é¢˜åˆ†æ

ç»è¿‡ä»”ç»†æ£€æŸ¥ä»£ç ï¼Œå‘ç°äº†ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

### 1. âœ… å‰ç«¯ä»£ç ç»“æ„æ­£ç¡®

**å‰ç«¯ API è°ƒç”¨æµç¨‹ï¼š**
```
å‰ç«¯ (mineruApi.ts)
  â†“
å¼€å‘ç¯å¢ƒ: /api/mineru/* â†’ Vite ä»£ç† â†’ http://localhost:8080/api/mineru/*
ç”Ÿäº§ç¯å¢ƒ: ${BACKEND_BASE_URL}/api/mineru/* â†’ ç›´æ¥è°ƒç”¨åç«¯
  â†“
åç«¯ (MineruProxyController.java)
  â†“
è½¬å‘åˆ° MinerU API: https://mineru.net/api/v4/*
```

### 2. âš ï¸ å‘ç°çš„é—®é¢˜

#### é—®é¢˜ 1: å‰ç«¯ Token å¯èƒ½è¢«å¿½ç•¥

**ç°è±¡ï¼š**
- å‰ç«¯åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«äº† `Authorization: Bearer ${API_TOKEN}`
- ä½†åç«¯åœ¨è½¬å‘åˆ° MinerU API æ—¶ï¼Œä½¿ç”¨çš„æ˜¯åç«¯é…ç½®çš„ `apiToken`
- **è¿™æ˜¯æ­£å¸¸çš„**ï¼Œå› ä¸ºåç«¯åº”è¯¥ä½¿ç”¨è‡ªå·±çš„ Token

**éªŒè¯æ–¹æ³•ï¼š**
- æ£€æŸ¥åç«¯æ—¥å¿—ï¼Œç¡®è®¤ä½¿ç”¨çš„æ˜¯å“ªä¸ª Token
- ç¡®ä¿ `application.yml` ä¸­çš„ `mineru.api.token` é…ç½®æ­£ç¡®

#### é—®é¢˜ 2: SSL æ¡æ‰‹å¤±è´¥ï¼ˆä¸»è¦é—®é¢˜ï¼‰

**ç°è±¡ï¼š**
- åç«¯åœ¨è°ƒç”¨ MinerU API æ—¶å‡ºç° `SSLHandshakeException`
- è¿™é€šå¸¸æ˜¯å› ä¸ºä»£ç†é…ç½®é—®é¢˜

**å¯èƒ½çš„åŸå› ï¼š**
1. ä»£ç†ä¸æ”¯æŒ HTTPS CONNECT æ–¹æ³•
2. ä»£ç†é…ç½®ä¸æ­£ç¡®
3. ç½‘ç»œé˜²ç«å¢™æ‹¦æˆª

### 3. âœ… å·²æ·»åŠ çš„æ”¹è¿›

#### 3.1 å‰ç«¯æ—¥å¿—å¢å¼º

å·²åœ¨å‰ç«¯ä»£ç ä¸­æ·»åŠ è¯¦ç»†çš„æ—¥å¿—ï¼š

```typescript
// æ¯ä¸ª API è°ƒç”¨éƒ½ä¼šè¾“å‡ºï¼š
console.log('ğŸ“¤ è°ƒç”¨ createExtractTask:', {
  url: `${MINERU_API_BASE}/extract/task`,
  params,
  isDevelopment
});

// æˆåŠŸæ—¶ï¼š
console.log('âœ… APIè¯·æ±‚æˆåŠŸ:', result);

// å¤±è´¥æ—¶ï¼š
console.error('âŒ APIè¯·æ±‚å¤±è´¥:', {
  status: response.status,
  statusText: response.statusText,
  error: errorText
});
```

#### 3.2 é”™è¯¯å¤„ç†æ”¹è¿›

- æ”¹è¿›äº†é”™è¯¯ä¿¡æ¯çš„è§£æ
- æ·»åŠ äº†è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- æä¾›äº†æ›´å‹å¥½çš„é”™è¯¯æç¤º

#### 3.3 é…ç½®æ£€æŸ¥

æ·»åŠ äº†é…ç½®ä¿¡æ¯çš„è¾“å‡ºï¼š

```typescript
console.log('ğŸ”§ MinerU API é…ç½®:', {
  isDevelopment,
  MINERU_API_BASE,
  BACKEND_BASE_URL,
  env: import.meta.env.MODE
});
```

---

## ğŸ”§ è¯Šæ–­æ­¥éª¤

### æ­¥éª¤ 1: æ£€æŸ¥å‰ç«¯æ—¥å¿—

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹ï¼š

1. **é…ç½®ä¿¡æ¯ï¼š**
   ```
   ğŸ”§ MinerU API é…ç½®: {
     isDevelopment: true,
     MINERU_API_BASE: "/api/mineru",
     BACKEND_BASE_URL: "http://localhost:8080",
     env: "development"
   }
   ```

2. **API è°ƒç”¨æ—¥å¿—ï¼š**
   ```
   ğŸ“¤ è°ƒç”¨ createExtractTask: {
     url: "/api/mineru/extract/task",
     params: {...},
     isDevelopment: true
   }
   ```

3. **é”™è¯¯ä¿¡æ¯ï¼š**
   ```
   âŒ APIè¯·æ±‚å¤±è´¥: {
     status: 500,
     statusText: "Internal Server Error",
     error: "..."
   }
   ```

### æ­¥éª¤ 2: æ£€æŸ¥åç«¯æ—¥å¿—

æŸ¥çœ‹åç«¯æ§åˆ¶å°æ—¥å¿—ï¼Œå…³æ³¨ï¼š

1. **ä»£ç†é…ç½®ï¼š**
   ```
   RestTemplate å·²é…ç½®ä»£ç†: 127.0.0.1:7890
   ```
   æˆ–
   ```
   RestTemplate æœªé…ç½®ä»£ç†ï¼Œä½¿ç”¨ç›´è¿
   ```

2. **API è°ƒç”¨å°è¯•ï¼š**
   ```
   å°è¯•åˆ›å»ºè§£æä»»åŠ¡ (ç¬¬ 1/3 æ¬¡): apiUrl=https://mineru.net/api/v4/extract/task, ä»£ç†=127.0.0.1:7890
   ```

3. **SSL æ¡æ‰‹å¤±è´¥è¯Šæ–­ï¼š**
   ```
   SSL æ¡æ‰‹å¤±è´¥è¯Šæ–­:
     - MinerU API URL: https://mineru.net/api/v4
     - ä»£ç†é…ç½®: 127.0.0.1:7890
     - å»ºè®®: æ£€æŸ¥ä»£ç†æ˜¯å¦æ”¯æŒ HTTPSï¼Œæˆ–å°è¯•ç¦ç”¨ä»£ç†
   ```

### æ­¥éª¤ 3: ä½¿ç”¨æµ‹è¯•ç«¯ç‚¹

è®¿é—®æµ‹è¯•ç«¯ç‚¹æ£€æŸ¥è¿æ¥ï¼š

```
GET http://localhost:8080/api/mineru/test-connection
```

**åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š**
```
http://localhost:8080/api/mineru/test-connection
```

**è¿”å›ä¿¡æ¯åŒ…æ‹¬ï¼š**
- MinerU API é…ç½®
- ä»£ç†é…ç½®çŠ¶æ€
- è¿æ¥æµ‹è¯•ç»“æœ
- é”™è¯¯è¯Šæ–­å’Œå»ºè®®

### æ­¥éª¤ 4: æ£€æŸ¥ä»£ç†é…ç½®

#### 4.1 æ£€æŸ¥ application.yml

```yaml
proxy:
  enabled: true   # æ˜¯å¦å¯ç”¨
  host: 127.0.0.1 # ä»£ç†åœ°å€
  port: 7890      # ä»£ç†ç«¯å£
```

#### 4.2 éªŒè¯ä»£ç†æ˜¯å¦è¿è¡Œ

**Clash ä»£ç†ï¼š**
- æ‰“å¼€ Clash å®¢æˆ·ç«¯
- æ£€æŸ¥çŠ¶æ€æ˜¯å¦æ˜¾ç¤º"å·²è¿æ¥"
- æŸ¥çœ‹ç«¯å£æ˜¯å¦ä¸º `7890`

**æµ‹è¯•ä»£ç†è¿æ¥ï¼š**
```powershell
# PowerShell
curl -x http://127.0.0.1:7890 https://mineru.net/api/v4
```

å¦‚æœå¤±è´¥ï¼Œè¯´æ˜ä»£ç†å¯èƒ½ä¸æ”¯æŒ HTTPSã€‚

### æ­¥éª¤ 5: å°è¯•ç¦ç”¨ä»£ç†

å¦‚æœä»£ç†æœ‰é—®é¢˜ï¼Œå¯ä»¥å°è¯•ç¦ç”¨ä»£ç†ï¼š

åœ¨ `application.yml` ä¸­ï¼š
```yaml
proxy:
  enabled: false  # ç¦ç”¨ä»£ç†
```

ç„¶åé‡å¯åº”ç”¨æµ‹è¯•ã€‚

---

## ğŸ¯ å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1: å‰ç«¯è¯·æ±‚ 404

**ç—‡çŠ¶ï¼š**
```
âŒ APIè¯·æ±‚å¤±è´¥: {
  status: 404,
  statusText: "Not Found"
}
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥åç«¯æ˜¯å¦æ­£åœ¨è¿è¡Œï¼ˆ`http://localhost:8080`ï¼‰
2. æ£€æŸ¥ Vite ä»£ç†é…ç½®æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥åç«¯è·¯ç”±æ˜ å°„æ˜¯å¦æ­£ç¡®

### é—®é¢˜ 2: å‰ç«¯è¯·æ±‚ 500

**ç—‡çŠ¶ï¼š**
```
âŒ APIè¯·æ±‚å¤±è´¥: {
  status: 500,
  statusText: "Internal Server Error"
}
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼Œæ‰¾åˆ°å…·ä½“é”™è¯¯
2. æ£€æŸ¥åç«¯é…ç½®æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥åç«¯æ˜¯å¦èƒ½è¿æ¥åˆ° MinerU API

### é—®é¢˜ 3: SSL æ¡æ‰‹å¤±è´¥

**ç—‡çŠ¶ï¼š**
åç«¯æ—¥å¿—æ˜¾ç¤ºï¼š
```
SSLHandshakeException: Remote host terminated the handshake
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ä»£ç†é…ç½®
2. å°è¯•ç¦ç”¨ä»£ç†
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
4. ä½¿ç”¨æµ‹è¯•ç«¯ç‚¹è¯Šæ–­

### é—®é¢˜ 4: è¿æ¥è¶…æ—¶

**ç—‡çŠ¶ï¼š**
```
ConnectTimeoutException
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. æ£€æŸ¥ MinerU API æ˜¯å¦å¯è®¿é—®
3. å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆå·²åœ¨ä»£ç ä¸­é…ç½®ä¸º 60 ç§’ï¼‰

---

## ğŸ“Š è°ƒè¯•æ£€æŸ¥æ¸…å•

- [ ] å‰ç«¯æ§åˆ¶å°æ˜¯å¦æœ‰é…ç½®ä¿¡æ¯è¾“å‡ºï¼Ÿ
- [ ] å‰ç«¯æ§åˆ¶å°æ˜¯å¦æœ‰ API è°ƒç”¨æ—¥å¿—ï¼Ÿ
- [ ] å‰ç«¯è¯·æ±‚æ˜¯å¦åˆ°è¾¾åç«¯ï¼ˆæ£€æŸ¥åç«¯æ—¥å¿—ï¼‰ï¼Ÿ
- [ ] åç«¯æ˜¯å¦é…ç½®äº†ä»£ç†ï¼Ÿ
- [ ] ä»£ç†æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Ÿ
- [ ] åç«¯æ˜¯å¦èƒ½è¿æ¥åˆ° MinerU APIï¼Ÿ
- [ ] æµ‹è¯•ç«¯ç‚¹è¿”å›ä»€ä¹ˆç»“æœï¼Ÿ
- [ ] æ˜¯å¦å°è¯•è¿‡ç¦ç”¨ä»£ç†ï¼Ÿ

---

## ğŸ’¡ å¿«é€Ÿæµ‹è¯•

### æµ‹è¯• 1: æ£€æŸ¥åç«¯å¥åº·çŠ¶æ€

```bash
curl http://localhost:8080/api/mineru/health
```

**é¢„æœŸè¿”å›ï¼š**
```json
{
  "status": "ok",
  "message": "MinerUä»£ç†æœåŠ¡è¿è¡Œæ­£å¸¸",
  "timestamp": 1234567890
}
```

### æµ‹è¯• 2: æµ‹è¯• MinerU API è¿æ¥

```bash
curl http://localhost:8080/api/mineru/test-connection
```

**é¢„æœŸè¿”å›ï¼š**
```json
{
  "success": true,
  "mineruApiBase": "https://mineru.net/api/v4",
  "apiTokenConfigured": true,
  "proxyEnabled": true,
  "proxyHost": "127.0.0.1",
  "proxyPort": 7890,
  "connectionTest": "è¿æ¥æˆåŠŸï¼ˆç«¯ç‚¹ä¸å­˜åœ¨ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼‰",
  "responseStatus": "404 NOT_FOUND"
}
```

### æµ‹è¯• 3: æ£€æŸ¥å‰ç«¯é…ç½®

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
ğŸ”§ MinerU API é…ç½®: {
  isDevelopment: true,
  MINERU_API_BASE: "/api/mineru",
  BACKEND_BASE_URL: "http://localhost:8080",
  env: "development"
}
```

---

## ğŸ” ä¸‹ä¸€æ­¥æ“ä½œ

1. **æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°**ï¼ŒæŸ¥çœ‹å‰ç«¯æ—¥å¿—
2. **æŸ¥çœ‹åç«¯æ—¥å¿—**ï¼Œæ‰¾åˆ°å…·ä½“é”™è¯¯
3. **è®¿é—®æµ‹è¯•ç«¯ç‚¹**ï¼Œæ£€æŸ¥è¿æ¥çŠ¶æ€
4. **æ ¹æ®è¯Šæ–­ç»“æœ**ï¼Œé‡‡å–ç›¸åº”æªæ–½

---

**æœ€åæ›´æ–°**ï¼š2025-11-10

