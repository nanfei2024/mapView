# 知识图谱智能问答功能

## ✅ 功能概述

在知识图谱页面下方添加了智能问答界面，支持：
- 💬 自然语言问答
- 🔍 智能节点搜索
- 🎯 一键跳转到相关节点
- 🤖 预留 AI 接口

## 🎨 界面设计

### 布局结构
```
┌─────────────────────────────────┐
│      知识图谱可视化区域          │
│      (上方，可交互的图谱)        │
├─────────────────────────────────┤
│      智能问答界面                │
│      (下方，400px 高度)          │
└─────────────────────────────────┘
```

### 问答界面组成
1. **对话历史区**
   - 用户消息（紫色渐变气泡）
   - AI 回答（白色气泡）
   - 相关节点卡片
   - 时间戳

2. **输入区域**
   - 多行文本输入框
   - 发送按钮
   - AI 增强开关
   - 清空历史按钮

## 🚀 核心功能

### 1. 基础问答

支持的问题类型：

#### 书籍相关
```
Q: 板块构造与地貌形迹这本书讲了什么？
A: 这本书详细阐述了板块构造理论与地貌形成的关系...
   📍 相关节点: [板块构造与地貌形迹]
```

#### 章节相关
```
Q: 有哪些关于劳亚区系的内容？
A: 劳亚区系是古生代晚期至中生代早期存在的一个超大陆...
   📍 相关节点: [第一章：劳亚区系]
```

#### 图表相关
```
Q: 这些书籍有哪些图表？
A: 知识图谱中包含多个图表资源...
   📍 相关节点: [图1-1：板块分布图] [表1-1：地质年代表]
```

### 2. 智能搜索

系统会自动搜索相关节点：
- 书籍节点
- 章节节点
- 图表节点
- 引文节点

### 3. 节点跳转

点击相关节点卡片后：
1. ✅ 自动展开到目标节点的路径
2. ✅ 在图谱中高亮显示节点（3秒）
3. ✅ 显示跳转成功提示

### 4. AI 增强（预留）

勾选"🤖 使用 AI 增强"后：
- 使用更智能的回答
- 支持复杂问题理解
- 提供深度知识解析

## 💡 使用示例

### 示例 1：查询书籍内容

**用户**：板块构造与地貌形迹这本书讲了什么？

**AI**：《板块构造与地貌形迹》
这本书详细阐述了板块构造理论与地貌形成的关系，重点研究劳亚区系、冈瓦纳区系和特提斯陆间带的地质特征及其演化过程。

📍 相关节点：
[📚 板块构造与地貌形迹]

*点击节点卡片即可在图谱中定位*

### 示例 2：查询章节信息

**用户**：什么是特提斯陆间带？

**AI**：特提斯陆间带是位于劳亚大陆和冈瓦纳大陆之间的古海洋区域，在地球历史上扮演了重要角色。相关内容在《板块构造与地貌形迹》第三章。

📍 相关节点：
[📖 第三章：特提斯陆间带]

### 示例 3：查询图表

**用户**：有哪些图表？

**AI**：知识图谱中包含多个图表资源，包括板块分布图、地貌演化图、地质年代表等。

📍 相关节点：
[🖼️ 图1-1：板块分布图]
[📋 表1-1：地质年代表]

## 🎯 快速开始

### 1. 访问页面
```
http://localhost:5173/hierarchical-graph
```

### 2. 查看示例问题
首次打开时，界面会显示示例问题，点击即可快速体验。

### 3. 输入问题
在底部输入框输入您的问题，按 Enter 或点击发送按钮。

### 4. 查看回答
AI 会给出回答，并显示相关节点。

### 5. 跳转节点
点击节点卡片，图谱会自动定位并高亮该节点。

## 🤖 AI 接口集成

### 预留的 AI 接口

```typescript
const getAIAnswer = async (question: string): Promise<Message> => {
  // TODO: 接入 AI API
  
  // 方案 1: OpenAI API
  const response = await fetch('https://api.openai.com/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      model: 'gpt-4',
      messages: [
        { role: 'system', content: '你是一个地质科学知识助手...' },
        { role: 'user', content: question }
      ]
    })
  });
  
  // 方案 2: 本地 LLM
  const response = await fetch('/api/ai/chat', {
    method: 'POST',
    body: JSON.stringify({ 
      question, 
      context: props.graphData 
    })
  });
  
  return processAIResponse(response);
};
```

### 支持的 AI 服务

1. **OpenAI GPT-4**
   - 最强大的理解能力
   - 需要 API Key
   - 按使用量付费

2. **Claude (Anthropic)**
   - 长文本理解
   - 更安全的输出
   - 需要 API Key

3. **本地 LLM**
   - Ollama + Llama 3
   - 完全私有化
   - 免费使用

4. **Azure OpenAI**
   - 企业级服务
   - 数据安全
   - 需要订阅

### 集成步骤

1. **选择 AI 服务**
2. **获取 API Key**
3. **配置环境变量**
   ```env
   VITE_AI_API_KEY=your_api_key
   VITE_AI_ENDPOINT=https://api.openai.com/v1
   ```
4. **实现 `getAIAnswer` 函数**
5. **测试和优化**

## 📊 技术实现

### 组件结构

```
KnowledgeQA.vue (问答组件)
├── 对话历史区
│   ├── 用户消息
│   ├── AI 回答
│   └── 相关节点卡片
└── 输入区域
    ├── 文本输入框
    ├── 发送按钮
    └── 控制按钮
```

### 数据流

```
用户输入问题
    ↓
本地问答引擎 / AI API
    ↓
搜索相关节点
    ↓
生成回答 + 节点列表
    ↓
显示在对话历史
    ↓
用户点击节点
    ↓
触发 jumpToNode 事件
    ↓
图谱展开并高亮节点
```

### 核心方法

1. **getLocalAnswer()** - 本地问答逻辑
2. **getAIAnswer()** - AI 增强问答
3. **jumpToNode()** - 节点跳转
4. **searchNodes()** - 节点搜索

## 🎨 UI 特性

### 1. 渐变设计
- 用户消息：紫色渐变
- AI 消息：白色卡片
- 发送按钮：紫色渐变

### 2. 动画效果
- 消息淡入动画
- AI 思考中的点点点
- 节点卡片悬停效果

### 3. 响应式
- 自动滚动到最新消息
- 输入框自适应高度
- 移动端友好

## 🔧 自定义配置

### 修改问答逻辑

编辑 `KnowledgeQA.vue` 中的 `getLocalAnswer` 函数：

```typescript
const getLocalAnswer = (question: string): Message => {
  // 添加自定义问答规则
  if (question.includes('你的关键词')) {
    return {
      type: 'bot',
      content: '你的回答',
      nodes: [...相关节点]
    };
  }
};
```

### 修改示例问题

```typescript
const exampleQuestions = [
  '你的问题1',
  '你的问题2',
  '你的问题3'
];
```

### 修改界面高度

```css
.qa-container {
  height: 400px; /* 修改这里 */
}
```

## 📝 待优化功能

### 短期优化
- [ ] 添加更多预设问题
- [ ] 支持多轮对话上下文
- [ ] 添加语音输入
- [ ] 支持导出对话记录

### 长期优化
- [ ] 接入真实 AI 服务
- [ ] 支持图片识别
- [ ] 多语言支持
- [ ] 知识图谱推理

## 🐛 故障排除

### 问题1：节点跳转不工作

**解决方案**：
1. 检查节点 ID 是否正确
2. 确认图表已初始化
3. 查看控制台错误信息

### 问题2：AI 开关无效

**解决方案**：
- 目前 AI 功能为演示模式
- 需要实现 `getAIAnswer` 函数
- 配置 AI API 后才能使用

### 问题3：消息不显示

**解决方案**：
1. 检查 `graphData` 是否传递
2. 确认组件正确导入
3. 查看浏览器控制台

## 🎉 效果展示

现在的知识图谱页面包含：
- ✅ 上方：交互式知识图谱
- ✅ 下方：智能问答界面
- ✅ 无缝集成，体验流畅
- ✅ 支持节点跳转和高亮
- ✅ 预留 AI 接口，易于扩展

刷新页面即可体验完整功能！
