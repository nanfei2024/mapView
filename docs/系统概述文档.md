# 书籍知识图谱系统 - 系统概述文档

## 📖 项目简介

书籍知识图谱系统是一个基于 Vue 3 + TypeScript 的可视化知识管理平台，专门用于展示和管理地质科学类书籍的知识结构。系统通过直观的图谱可视化和智能问答功能，帮助用户更好地理解和探索书籍内容。

### 核心特性

- 📊 **三层级知识图谱**：书籍 → 分类 → 具体内容
- 🎨 **封面可视化**：书籍节点显示真实封面
- ✏️ **在线编辑**：支持节点的增删改操作
- 💬 **智能问答**：自然语言问答 + 节点跳转
- 🤖 **AI 增强**：预留 AI 接口，可接入 GPT-4 等模型
- 📱 **响应式设计**：支持桌面和移动端

---

## 🏗️ 系统架构

### 整体架构图

```
┌─────────────────────────────────────────────────────────┐
│                    用户界面层                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │ 书籍列表页面  │  │ 知识图谱页面  │  │ 文件管理中心  │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└────────────────────────┬────────────────────────────────┘
                         │
┌────────────────────────┴────────────────────────────────┐
│                    前端应用层                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │ Vue Router   │  │ ECharts图谱  │  │ 问答组件     │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└────────────────────────┬────────────────────────────────┘
                         │ HTTP/WebSocket
┌────────────────────────┴────────────────────────────────┐
│                    后端服务层                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │ 图谱管理服务  │  │ 问答服务     │  │ 搜索服务     │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└────────────────────────┬────────────────────────────────┘
                         │
┌────────────────────────┴────────────────────────────────┐
│                    数据存储层                            │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │ PostgreSQL   │  │ Redis缓存    │  │ 文件存储     │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
└─────────────────────────────────────────────────────────┘
```

### 技术栈

#### 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Vue 3 | 3.4+ | 前端框架 |
| TypeScript | 5.0+ | 类型系统 |
| Vite | 5.0+ | 构建工具 |
| Vue Router | 4.0+ | 路由管理 |
| ECharts | 6.0+ | 图谱可视化 |
| Axios | 1.6+ | HTTP 客户端 |

#### 后端技术栈（推荐）

| 技术 | 版本 | 用途 |
|------|------|------|
| Node.js | 18+ | 运行环境 |
| Express/Koa | 4.x/2.x | Web 框架 |
| PostgreSQL | 14+ | 主数据库 |
| Redis | 7+ | 缓存 |
| Neo4j | 5+ | 图数据库（可选） |

---

## 📂 项目结构

### 前端目录结构

```
mapView-main/
├── public/                      # 静态资源
│   └── images/                  # 书籍封面图片
├── src/
│   ├── views/                   # 页面组件
│   │   ├── HierarchicalGraphPage.vue    # 知识图谱主页面
│   │   ├── BookListPage.vue             # 书籍列表页
│   │   └── FileListPage.vue             # 文件管理中心
│   ├── components/              # 通用组件
│   │   ├── KnowledgeQA.vue              # 智能问答组件
│   │   ├── GraphVisualization.vue       # 图谱可视化组件
│   │   └── HierarchicalKnowledgeGraph.vue  # 嵌入式图谱
│   ├── api/                     # API 接口
│   │   ├── graphApi.ts          # 图谱相关 API
│   │   ├── bookApi.ts           # 书籍相关 API
│   │   └── qaApi.ts             # 问答相关 API
│   ├── types/                   # 类型定义
│   │   ├── graph.ts             # 图谱类型
│   │   └── api.ts               # API 类型
│   ├── utils/                   # 工具函数
│   │   ├── knowledgeExtractor.ts  # 知识抽取
│   │   └── graphHelper.ts       # 图谱辅助函数
│   ├── router/                  # 路由配置
│   │   └── index.ts
│   ├── App.vue                  # 根组件
│   └── main.ts                  # 入口文件
├── docs/                        # 文档
│   ├── API接口文档.md
│   ├── 数据库设计文档.md
│   └── 系统概述文档.md
├── package.json
├── vite.config.ts
└── tsconfig.json
```

### 后端目录结构（推荐）

```
knowledge-graph-api/
├── src/
│   ├── controllers/             # 控制器
│   │   ├── bookController.ts
│   │   ├── graphController.ts
│   │   └── qaController.ts
│   ├── services/                # 业务逻辑
│   │   ├── bookService.ts
│   │   ├── graphService.ts
│   │   └── qaService.ts
│   ├── models/                  # 数据模型
│   │   ├── Book.ts
│   │   ├── KnowledgeNode.ts
│   │   └── KnowledgeEdge.ts
│   ├── routes/                  # 路由
│   │   ├── bookRoutes.ts
│   │   ├── graphRoutes.ts
│   │   └── qaRoutes.ts
│   ├── middleware/              # 中间件
│   │   ├── auth.ts
│   │   ├── errorHandler.ts
│   │   └── logger.ts
│   ├── utils/                   # 工具函数
│   │   ├── database.ts
│   │   └── validator.ts
│   ├── config/                  # 配置文件
│   │   └── database.ts
│   └── app.ts                   # 应用入口
├── tests/                       # 测试文件
├── scripts/                     # 脚本文件
│   └── init-db.sql
├── package.json
└── tsconfig.json
```

---

## 🎯 核心功能模块

### 1. 知识图谱可视化

#### 功能描述
- 三层级树状结构展示
- 第一层：书籍节点（显示封面）
- 第二层：目录、图表、引文
- 第三层：具体章节、图片、表格、引用

#### 交互功能
- 点击节点展开/收起子节点
- 拖拽节点调整位置
- 鼠标滚轮缩放视图
- 节点悬停显示详情
- 力导向布局自动排列

#### 技术实现
```typescript
// 使用 ECharts 的 graph 类型
chart.setOption({
  series: [{
    type: 'graph',
    layout: 'force',
    data: nodes,
    links: edges,
    roam: true,
    draggable: true
  }]
});
```

### 2. 节点编辑功能

#### 功能描述
- 添加子节点
- 编辑节点信息
- 删除节点（书籍节点除外）
- 批量操作

#### 权限控制
- 需要开启编辑模式
- 右键菜单操作
- 类型限制（父子节点类型匹配）

#### 操作流程
```
1. 点击"编辑"按钮开启编辑模式
2. 右键点击节点
3. 选择操作（添加/编辑/删除）
4. 填写表单
5. 保存修改
```

### 3. 智能问答系统

#### 功能描述
- 自然语言问答
- 节点智能搜索
- 一键跳转定位
- AI 增强（可选）

#### 支持的问题类型
1. **书籍内容查询**
   - "板块构造与地貌形迹讲了什么？"
   - "有哪些书籍？"

2. **章节信息查询**
   - "什么是劳亚区系？"
   - "特提斯陆间带在哪一章？"

3. **图表资源查询**
   - "有哪些图表？"
   - "板块分布图在哪里？"

4. **引文参考查询**
   - "有哪些参考文献？"
   - "威尔逊旋回理论是什么？"

#### 问答流程
```
用户提问 → 本地/AI 分析 → 搜索相关节点 → 生成回答 → 显示结果 → 点击跳转
```

### 4. 数据持久化

#### 功能描述
- 图谱数据保存
- 历史版本管理
- 导入/导出功能
- 增量更新

#### 数据格式
```json
{
  "bookId": "book1",
  "version": "1.0",
  "graph": {
    "nodes": [...],
    "edges": [...]
  },
  "metadata": {
    "lastUpdated": "2024-01-01T00:00:00Z"
  }
}
```

---

## 🔌 接口设计

### RESTful API 规范

#### 基础 URL
```
http://localhost:8080/api
```

#### 主要接口

| 接口 | 方法 | 说明 |
|------|------|------|
| `/books` | GET | 获取所有书籍 |
| `/books/:id` | GET | 获取单本书籍 |
| `/knowledge-graph/books/:id` | GET | 获取知识图谱 |
| `/knowledge-graph/books/:id` | POST | 保存知识图谱 |
| `/knowledge-graph/nodes` | POST | 添加节点 |
| `/knowledge-graph/nodes/:id` | PUT | 更新节点 |
| `/knowledge-graph/nodes/:id` | DELETE | 删除节点 |
| `/qa/ask` | POST | 提问 |
| `/qa/ai-ask` | POST | AI 增强问答 |
| `/search` | GET | 全文搜索 |

详细接口文档请参考 [API接口文档.md](./API接口文档.md)

---

## 💾 数据模型

### 核心数据结构

#### GraphNode 接口

```typescript
interface GraphNode {
  id: string;              // 节点唯一标识
  name: string;            // 节点名称
  category: string;        // 节点类型
  level: number;           // 层级：1/2/3
  symbolSize: number;      // 节点大小
  description?: string;    // 节点描述
  children?: GraphNode[];  // 子节点列表
  collapsed?: boolean;     // 是否收起
  coverUrl?: string;       // 封面图片URL（仅书籍节点）
  metadata?: any;          // 扩展元数据
}
```

#### 节点类型

| 类型 | 层级 | 说明 |
|------|------|------|
| 书籍 | 1 | 根节点，显示封面 |
| 目录 | 2 | 章节目录 |
| 图表 | 2 | 图片和表格 |
| 引文 | 2 | 参考文献 |
| 章节 | 3 | 具体章节 |
| 图片 | 3 | 图片资源 |
| 表格 | 3 | 表格资源 |
| 引用 | 3 | 具体引用 |

详细数据库设计请参考 [数据库设计文档.md](./数据库设计文档.md)

---

## 🚀 部署指南

### 开发环境

#### 前端

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 访问
http://localhost:5173
```

#### 后端

```bash
# 安装依赖
npm install

# 配置环境变量
cp .env.example .env

# 初始化数据库
npm run db:init

# 启动服务
npm run dev

# 访问
http://localhost:8080
```

### 生产环境

#### 前端构建

```bash
# 构建生产版本
npm run build

# 预览
npm run preview
```

#### 使用 Docker 部署

```dockerfile
# Dockerfile
FROM node:18-alpine as builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

```bash
# 构建镜像
docker build -t knowledge-graph-frontend .

# 运行容器
docker run -d -p 80:80 knowledge-graph-frontend
```

---

## 🔧 配置说明

### 环境变量

#### 前端 (.env)

```env
# API 基础 URL
VITE_API_BASE_URL=http://localhost:8080

# AI API 配置
VITE_AI_API_KEY=your_api_key
VITE_AI_ENDPOINT=https://api.openai.com/v1
```

#### 后端 (.env)

```env
# 服务器配置
PORT=8080
NODE_ENV=production

# 数据库配置
DB_HOST=localhost
DB_PORT=5432
DB_NAME=knowledge_graph
DB_USER=postgres
DB_PASSWORD=your_password

# Redis 配置
REDIS_HOST=localhost
REDIS_PORT=6379

# JWT 配置
JWT_SECRET=your_secret_key
JWT_EXPIRES_IN=7d

# AI 配置
OPENAI_API_KEY=your_api_key
```

---

## 📊 性能优化

### 前端优化

1. **代码分割**
   - 路由懒加载
   - 组件按需加载

2. **资源优化**
   - 图片压缩
   - 使用 CDN

3. **渲染优化**
   - 虚拟滚动
   - 防抖节流

### 后端优化

1. **数据库优化**
   - 索引优化
   - 查询优化
   - 连接池

2. **缓存策略**
   - Redis 缓存
   - HTTP 缓存

3. **负载均衡**
   - Nginx 反向代理
   - 集群部署

---

## 🔒 安全考虑

### 前端安全

- XSS 防护
- CSRF 防护
- 输入验证

### 后端安全

- JWT 认证
- SQL 注入防护
- 参数验证
- 速率限制

---

## 📈 监控与日志

### 日志系统

- 访问日志
- 错误日志
- 性能日志

### 监控指标

- API 响应时间
- 数据库查询性能
- 系统资源使用

---

## 🧪 测试

### 单元测试

```bash
npm run test
```

### 集成测试

```bash
npm run test:e2e
```

### API 测试

使用 Postman 或 curl 测试 API 接口

---

## 📚 相关文档

- [API 接口文档](./API接口文档.md)
- [数据库设计文档](./数据库设计文档.md)
- [智能问答功能说明](../智能问答功能说明.md)
- [编辑功能使用说明](../编辑功能使用说明.md)

---

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

---

## 📄 许可证

MIT License

---

## 📞 联系方式

如有问题，请联系技术支持团队。
