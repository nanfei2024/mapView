# 知识图谱编辑功能使用说明

## 🎯 功能概述

知识图谱现在支持完整的节点编辑功能，包括添加、编辑和删除节点。

## 📝 使用步骤

### 1. 进入编辑模式

1. 访问知识图谱页面：`/hierarchical-graph`
2. 点击顶部的 **"✏️ 编辑"** 按钮
3. 顶部会显示蓝色提示条："✏️ 编辑模式已开启 - 右键节点进行编辑操作"

### 2. 右键点击节点

在编辑模式下，**右键点击**任意节点，会弹出操作菜单：

- **➕ 添加子节点**：为当前节点添加子节点
- **✏️ 编辑**：修改当前节点的信息
- **🗑️ 删除**：删除当前节点（书籍节点不可删除）

### 3. 添加子节点

1. 右键点击父节点
2. 选择"添加子节点"
3. 在弹出的对话框中：
   - 输入节点名称（必填）
   - 选择节点类型（根据父节点自动过滤）
   - 输入描述信息（可选）
4. 点击"保存"按钮

### 4. 编辑节点

1. 右键点击要编辑的节点
2. 选择"编辑"
3. 修改节点信息
4. 点击"保存"按钮

### 5. 删除节点

1. 右键点击要删除的节点（书籍节点除外）
2. 选择"删除"
3. 节点及其所有子节点将被删除

### 6. 保存修改

点击顶部的 **"💾 保存"** 按钮，将当前图谱数据导出为 JSON 文件。

## 🎨 节点类型规则

不同层级的节点有不同的子节点类型限制：

| 父节点类型 | 可添加的子节点类型 |
|-----------|------------------|
| 书籍 | 目录、图表、引文 |
| 目录 | 章节 |
| 图表 | 图片、表格 |
| 引文 | 引用 |

## ⚠️ 注意事项

1. **必须先开启编辑模式**：点击顶部"编辑"按钮
2. **右键点击节点**：不是左键，是右键
3. **点击节点中心**：确保点击在节点圆圈范围内（40像素范围）
4. **书籍节点不可删除**：第一层的书籍节点只能编辑，不能删除
5. **点击空白处关闭菜单**：右键菜单会在点击其他地方时自动关闭

## 🔧 故障排除

### 问题：右键点击没有反应

**解决方案：**
1. 确认已开启编辑模式（顶部有蓝色提示条）
2. 确保点击在节点圆圈内，不要点击节点文字
3. 等待图谱加载完成后再操作
4. 刷新页面重试

### 问题：菜单位置不对

**解决方案：**
- 菜单会显示在鼠标点击的位置
- 如果菜单超出屏幕，可以稍微移动鼠标位置再右键

### 问题：无法添加某种类型的节点

**解决方案：**
- 检查父节点类型，不同父节点只能添加特定类型的子节点
- 参考上面的"节点类型规则"表格

## 💡 使用技巧

1. **先展开再编辑**：建议先展开节点查看结构，再进行编辑
2. **批量操作**：可以连续添加多个节点，不需要每次都关闭编辑模式
3. **定期保存**：编辑完成后记得点击"保存"按钮导出数据
4. **重置恢复**：如果操作错误，可以点击"重置"按钮恢复初始状态

## 🎯 快捷操作

- **左键点击节点**：展开/收起子节点（非编辑模式）
- **右键点击节点**：显示编辑菜单（编辑模式）
- **拖拽节点**：调整节点位置
- **鼠标滚轮**：缩放视图
- **点击空白处**：关闭右键菜单

## 示例操作流程

### 为"板块构造与地貌形迹"添加新章节

1. 点击"编辑"按钮开启编辑模式
2. 左键点击"板块构造与地貌形迹"展开
3. 左键点击"目录"展开
4. 右键点击"目录"节点
5. 选择"添加子节点"
6. 输入名称："第四章：新章节"
7. 选择类型："章节"
8. 点击"保存"
9. 新章节添加成功！

## 📞 技术支持

如果遇到问题，请检查：
1. 浏览器控制台是否有错误信息
2. ECharts 是否正确加载
3. 节点数据结构是否完整

---

**提示**：编辑功能使用原生 DOM 事件和坐标转换实现，确保在节点稳定后再进行操作以获得最佳体验。
