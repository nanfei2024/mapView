# 🔍 为什么源文件 PDF 显示不出来？完整解答

## 📋 问题现象

在文档对比预览页面，**左侧的原始 PDF 文件显示不出来**，只显示"无源文件预览"。

---

## 🎯 根本原因

### 原因 1：上传方式不同

文档数字化支持**两种上传方式**：

| 上传方式 | 源文件 | 是否有 URL | 能否预览 PDF |
|---------|--------|-----------|-------------|
| **🌐 URL上传** | 网络文件 | ✅ 有 | ✅ 可以 |
| **📁 本地上传** | 电脑文件 | ❌ 无 | ❌ 不行 |

### 原因 2：浏览器安全限制

**本地上传的文件**无法在另一个页面显示，这是浏览器的安全机制：

```
文档数字化页面 → 选择本地 PDF → 上传到 MinerU 服务器
                                         ↓
                                    解析完成
                                         ↓
                              点击"预览结果"
                                         ↓
                              跳转到预览页面
                                         ↓
                    ❌ 本地文件路径无法访问！
                    （安全限制：防止网页访问您的电脑文件）
```

### 原因 3：之前的代码 Bug（已修复）

**修复前**的代码问题：
```typescript
// ❌ 错误代码（已修复）
router.push({
  query: {
    originalUrl: urlInput.value || ''  // 只传递输入框的值
  }
});
```

这导致即使是 **URL 上传的文件** 也无法正确传递源 URL！

**修复后**：
```typescript
// ✅ 正确代码（当前版本）
interface UploadedFile {
  sourceUrl?: string; // 为每个文件保存源URL
}

router.push({
  query: {
    originalUrl: file.sourceUrl || ''  // 传递该文件的源URL
  }
});
```

---

## ✅ 解决方案

### 方案 1：使用 URL 上传（推荐）

**现在 URL 上传的文件可以正常显示 PDF 了！**

#### 步骤：

1. **获取文件的直链 URL**
   
   ✅ 可用的 URL 来源：
   - GitHub Releases
   - 阿里云 OSS
   - 腾讯云 COS
   - 七牛云
   - 奶牛快传
   - 自己的服务器

   ❌ 不可用的 URL：
   - `raw.githubusercontent.com`（被 MinerU 服务器屏蔽）
   - 百度网盘分享链接（不是直链）
   - 需要登录的私有链接

2. **在文档数字化页面选择"URL上传"**

3. **输入 PDF 的直链 URL**
   ```
   例如：
   https://your-domain.com/documents/report.pdf
   ```

4. **点击"开始解析"**

5. **解析完成后，点击"预览结果"**

6. **🎉 左侧显示原始 PDF，右侧显示解析结果！**

---

### 方案 2：本地上传（无法显示源 PDF）

如果您使用**本地上传**，左侧会显示：

```
📭
无源文件预览
此文件通过本地上传方式解析
浏览器安全限制无法显示原始PDF
右侧可查看完整解析结果 →
```

**这是正常的！**

#### 解决办法：

您可以：
1. ✅ **只看右侧的解析结果**（Markdown）
2. ✅ **下载完整结果 ZIP**，在本地对比
3. ✅ **自己打开原始 PDF**，手动对比

或者：
- 🔄 **改用 URL 上传方式**，就能左右对比了

---

## 📊 对比效果

### URL 上传（推荐）

```
┌─────────────────────────────────────────────────────┐
│  文件名.pdf  [下载] [切换布局]                       │
├─────────────────────────────────────────────────────┤
│  ┌───────────────────┬──────────────────────────┐   │
│  │ 📄 源文件          │ 📝 解析结果              │   │
│  ├───────────────────┼──────────────────────────┤   │
│  │                   │                          │   │
│  │ ✅ 显示原始PDF     │  # 标题                  │   │
│  │                   │  正文内容...             │   │
│  │ (可滚动查看)       │  - 列表项                │   │
│  │                   │  - 列表项                │   │
│  │ 左右对比           │                          │   │
│  │                   │  ## 二级标题             │   │
│  │                   │  ...                     │   │
│  └───────────────────┴──────────────────────────┘   │
└─────────────────────────────────────────────────────┘
```

### 本地上传

```
┌─────────────────────────────────────────────────────┐
│  文件名.pdf  [下载] [切换布局]                       │
├─────────────────────────────────────────────────────┤
│  ┌───────────────────┬──────────────────────────┐   │
│  │ 📄 源文件          │ 📝 解析结果              │   │
│  ├───────────────────┼──────────────────────────┤   │
│  │                   │                          │   │
│  │ 📭                │  # 标题                  │   │
│  │ 无源文件预览       │  正文内容...             │   │
│  │ 浏览器安全限制     │  - 列表项                │   │
│  │ 右侧可查看结果→    │  - 列表项                │   │
│  │                   │                          │   │
│  │                   │  ## 二级标题             │   │
│  │                   │  ...                     │   │
│  └───────────────────┴──────────────────────────┘   │
└─────────────────────────────────────────────────────┘
```

---

## 🔧 技术细节（给开发者）

### 问题根源

1. **本地文件的 File 对象无法跨页面传递**
   ```typescript
   // File 对象只在当前页面有效
   const file = event.target.files[0];
   
   // 无法通过路由参数传递
   router.push({ query: { file } }); // ❌ 不行
   ```

2. **Blob URL 的生命周期限制**
   ```typescript
   // 即使创建了 blob URL
   const blobUrl = URL.createObjectURL(file);
   
   // 跳转到新页面后，blob URL 可能失效
   router.push({ query: { url: blobUrl } }); // ❌ 不可靠
   ```

3. **浏览器同源策略**
   ```
   file:///C:/Users/admin/Desktop/document.pdf
   ↓
   无法从 http://localhost:5173 访问 file:/// 协议
   ```

### 修复详情

#### 1. 添加 `sourceUrl` 字段

```typescript
interface UploadedFile {
  name: string;
  sourceUrl?: string; // ✅ 新增：保存源文件URL
  resultUrl?: string;
  // ...
}
```

#### 2. URL 上传时保存源 URL

```typescript
const handleUrlUpload = async () => {
  const url = urlInput.value.trim();
  
  uploadedFiles.value.push({
    name: fileName,
    sourceUrl: url, // ✅ 保存源URL
    status: 'pending'
  });
  
  // 清空输入框（不影响已保存的 sourceUrl）
  urlInput.value = '';
};
```

#### 3. 本地上传时不设置 `sourceUrl`

```typescript
const processFile = async (file: File) => {
  uploadedFiles.value.push({
    name: file.name,
    file: file,
    // sourceUrl 为 undefined（本地文件没有URL）
    status: 'pending'
  });
};
```

#### 4. 预览时传递正确的 URL

```typescript
const previewResult = (file: UploadedFile) => {
  router.push({
    query: {
      originalUrl: file.sourceUrl || '' // ✅ 传递该文件的URL
    }
  });
};
```

#### 5. 预览页面显示逻辑

```vue
<template>
  <!-- 有 originalUrl：显示 PDF -->
  <iframe v-if="originalFileUrl" :src="originalFileUrl" />
  
  <!-- 无 originalUrl：显示友好提示 -->
  <div v-else class="empty-state">
    📭 无源文件预览
    此文件通过本地上传方式解析
  </div>
</template>
```

---

## 🎯 使用建议

### ⭐ 最佳实践

1. **优先使用 URL 上传**
   - 完整的左右对比体验
   - 可以随时回看源文件
   - 适合分享给他人

2. **本地上传仅用于临时测试**
   - 无需上传到网盘
   - 快速验证解析效果
   - 下载 ZIP 后本地对比

3. **重要文档建议流程**
   ```
   本地文档 → 上传到云存储（OSS等）→ 获取直链
              ↓
          复制 URL → 使用 URL 上传模式
              ↓
          完整对比预览 ✨
   ```

---

## 📝 常见问题

### Q1: 我用 URL 上传的，为什么还是显示不出来？

**可能原因：**

1. **URL 不是 PDF 文件的直链**
   - ❌ 错误：`https://pan.baidu.com/s/xxxxx`（分享页面）
   - ✅ 正确：`https://example.com/file.pdf`（直接下载链接）

2. **PDF 文件有跨域限制**
   - 某些服务器不允许跨域访问
   - 浏览器控制台（F12）会显示 CORS 错误

3. **URL 需要认证**
   - 某些私有链接需要登录
   - 浏览器无法直接访问

**解决方法：**
- 使用公开的、支持跨域的直链
- 或者查看右侧的解析结果（不受影响）

### Q2: 之前 URL 上传的文件，现在能正常显示 PDF 了吗？

**答：可以了！** 已修复代码 Bug。

**但需要：**
- ✅ 重新解析文档（新解析的文件会保存 `sourceUrl`）
- 或者：等我们加上持久化存储功能

### Q3: 能不能让本地上传也显示 PDF？

**技术上非常困难：**

1. **安全限制**：浏览器不允许网页访问本地文件
2. **跨页面传递**：File 对象无法跨页面
3. **替代方案**：
   - 使用 `<canvas>` 渲染 PDF（需要 pdf.js，复杂且耗性能）
   - 使用 Base64 编码（文件太大会卡死浏览器）
   - 使用本地存储（localStorage 有大小限制）

**结论：成本太高，收益太低**

建议：**使用 URL 上传方式**即可完美解决！

---

## 🎉 总结

| 问题 | 原因 | 解决方案 |
|------|------|---------|
| **URL上传显示不出** | 代码Bug | ✅ 已修复（保存sourceUrl） |
| **本地上传显示不出** | 浏览器安全限制 | ⚠️ 无法解决（改用URL上传）|

### ✅ 当前状态

- **URL 上传**：✅ 完全支持左右对比
- **本地上传**：✅ 右侧解析结果正常，左侧显示友好提示
- **用户体验**：✅ 清晰的提示信息，不会困惑

### 🚀 建议

**需要完整对比体验？** → 使用 **URL 上传** 方式！

1. 将文件上传到云存储（阿里云OSS、七牛云等）
2. 获取公开的直链 URL
3. 在文档数字化页面使用"URL上传"
4. 享受完整的左右对比预览！🎉

---

**希望这个解答能帮助您理解！** 如有其他问题，随时提问！ 😊

